<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Web Development &mdash; Backend Development</title>

		<meta name="description" content="Web Development &mdash; Backend Development &mdash; 04.laravel.basics">
		<meta name="author" content="Joris Maervoet - ikdoeict.be">

		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">
		<style>
			html, body {
				background: #34afbd;
				background: -moz-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%,#34afbd), color-stop(100%,#1c1e20));
				background: -webkit-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -o-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -ms-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				letter-spacing: 0em;
			}

			#reveal nav {
				opacity: 0.3;
				letter-spacing: -0.02em;
			}
		</style>
	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- Title -->
				<section>
					<section>
						<h3 class="inverted">Backend Development <small>[JLW506]</small></h3>
						<h1>04.laravel basics</h1>

						<footer>
							<em>Course materials: <a href="mailto:joris.maervoet@odisee.be">Joris Maervoet</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>
				</section>


				<!-- Getting started with Laravel -->
				<section>
					<section>
						<h2>Getting started with Laravel</h2>
						<p><img src="assets/04/laravel-logo-white.png" alt="" title="" width="547" /></p>
					</section>

					<section>
						<h2>Laravel</h2>
						<ul>
							<li class="fragment">Full-featured PHP Framework for the development of web applications 
								<ul>
									<li class="fragment">Model–View–Controller (MVC) pattern</li>
									<li class="fragment">
										A <strong>huge</strong> number of built-in features
										<ul>
											<li class="fragment">Routing</li>
											<li class="fragment">Views and Template engine</li>
											<li class="fragment">DB-related: ORM, Query Builder, Migrations, &hellip;</li>
											<li class="fragment">Simple authentication</li>
											<li class="fragment">Queues, Logging, &hellip;</li>
										</ul>
									</li>
									<li class="fragment">Emphasis on <em>beautiful code</em> (through syntactic sugar)</li>
									<li class="fragment">Artisan CLI
										<ul>
											<li class="fragment">Example usages: generate classes, clear cache</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Installation (1)</h2>
						<ul>
							<li class="fragment">
								Installable via Composer
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ composer create-project --prefer-dist laravel/laravel projectname 5.3.*</code></pre>
								<ul>
									<li class="fragment">Version is optional - beware though: 5.x not backwards compatible</li>
									<li class="fragment"><a href="https://getcomposer.org/doc/03-cli.md#create-project">Composer docs</a>: <code>composer create-project</code> is the equivalent of doing a <code>git clone</code> followed by a <code>composer install</code> of the vendors.</li>
									<li class="fragment">In other words:
										<ul>
											<li class="fragment">It downloads the whole project structure including folders, PHP-files, an <code>.htaccess</code> file and a rather complex <code>composer.json</code> file. </li>
											<li class="fragment">Next, all dependencies are installed in the <code>vendor</code> folder and <code>composer.lock</code> is generated.</li>
											<li class="fragment">So: <strong>you start with an already <em>working</em> project</strong></li>
										</ul>
									</li>
								</ul> 
							</li>

						</ul>
					</section>
					
					<section>
						<h2>Installation (2)</h2>
						<ul>
							<li class="fragment">
								If you prefer <em>beautiful</em> commands such as <code>laravel new projectname</code>, you need to check <a href="https://laravel.com/docs/5.3#installing-laravel">Laravel Installer</a> (install via Composer)
							</li>
						</ul>
					</section>
					
					<section>
						<h2><small>(Already installed)</small> <a href="https://laravel.com/docs/5.3/structure">project structure</a> (1)</h2>
						<ul>
							<li class="fragment">
								<code>public/</code> &mdash; Public files
								<ul>
									<li class="fragment"><code class="special">index.php</code> &mdash; Request Entry Point</li>
									<li class="fragment">add your assets: <code>css/</code> <span style="font-size: 70%">&amp;</span> <code>js/</code> <span style="font-size: 70%">&amp;</span> <code>img/</code> <span style="font-size: 70%">&amp;</span> <code>files/</code> <span style="font-size: 70%">&amp;</span> &hellip;</li>
									<li class="fragment"><code>.htaccess</code> (<a href="03.url.design.html#/2">or the like</a>)</li>
								</ul>
							</li>
							<li class="fragment">
								<code>app/</code> &mdash; Core code of your application &mdash; 8 subfolders e.g.
								<ul>
									<li class="fragment"><code>Console/</code> &mdash; Your Artisan commands</li>
									<li class="fragment"><code>Http/</code> &mdash; Your routes, controllers, middleware, and requests.</li>
								</ul>
							</li>
							<li class="fragment">
								<code>bootstrap/</code> &mdash; Bootstrap and autoloading
							</li>
							<li class="fragment">
								<code>config/</code> &mdash; Configuration files
							</li>
							<li class="fragment">
								<code>database/</code> &mdash; Database migration and seeds
							</li>
							
						</ul>
						<footer class="fragment"><em>Note: Make sure only the contents of <code>public/</code> are accessible over HTTP!</em></footer>
					</section>
					
					<section>
						<h2><small>(Already installed)</small> <a href="https://laravel.com/docs/5.3/structure">project structure</a> (2)</h2>
						<ul>
							<li class="fragment">
								<code>resources/</code> &mdash; Raw assets (to be compiled) such as templates and localization files
							</li>
							<li class="fragment">
								<code>storage/</code> &mdash; All kinds of generated files: logs, transpiled templates, caches, &hellip;
							</li>
							<li class="fragment">
								<code>tests/</code> &mdash; Automated tests (PHPUnit)
							</li>
							<li class="fragment">
								<code>vendor/</code> &mdash; <em>(as created by Composer)</em>
							</li>
							<li class="fragment">
								<code>.env</code> &mdash; Environment configuration: see next slides
							</li>
							<li class="fragment">
								<code>.gitignore</code> &mdash; <em>(already configured)</em>
							</li>
							<li class="fragment">
								<code>artisan</code> &mdash; supports Artisan CLI
							</li>
							<li class="fragment">
								<code>composer.json</code> <span style="font-size: 70%">&amp;</span> <code>composer.lock</code>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>The Request Lifecycle <small>how Laravel works</small></h2>
						<ul class="fragment">
							<li>Webserver hands over the request to <code>public/index.php</code></li>
							<li>It loads Composer's autoloader</li>
							<li>It retrieves an instance of the application <a href="https://laravel.com/docs/5.3/container">service container</a> from the <code>bootstrap/app.php</code> script</li>
							<li>Next, the request is handled by the <strong>HTTP Kernel</strong>
								<ul class="fragment">
									<li>Bootstrapping includes calling <code>register</code> and <code>boot</code> on the 
									<a href="https://laravel.com/docs/5.3/providers">service providers</a> defined in <code>config/app.php</code></li>
									<li>Request passes the middleware e.g. session handling, CSRF token</li>
									<li>Next, the request is dispatched to the router</li>
								</ul>
							
							</li>
						</ul>
						<footer class="fragment"><em>Read more on <a href="https://laravel.com/docs/5.3/providers">Laravel Service Providers</a></em></footer>
					</section>	
					
					<section>
						<h2>Artisan Console</h2>
						<ul>
							<li class="fragment">
								Functions: clear caches, generate classes, &hellip;
							</li>
							<li class="fragment">
								Available commands and help
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ php artisan list</code></pre>
								</li>
							</li>
							<li class="fragment">
								Help on a specific command
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ php artisan help serve</code></pre>
								</li>
							</li>
							<li class="fragment">
								Host project on PHP 5.4+'s built-in development server
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ php artisan serve --port=8080</code></pre>
								</li>
							</li>
							<li class="fragment">
								You can <a href="https://laravel.com/docs/5.3/artisan">extend Artisan with your own commands</a>
							</li>
							
							
						</ul>
						<footer class="fragment"><em>Driven by Symfony Console</em></footer>
					</section>
					
					<section>
						<h2>Need help?!</h2>
						<ul>
							<li class="fragment">
								Docs: <a href="https://laravel.com/docs/5.3/">https://laravel.com/docs/5.3/</a>
							</li>
							<li class="fragment">
								API: <a href="https://laravel.com/api/5.3/">https://laravel.com/api/5.3/</a>
							</li>
							
							<li class="fragment">
								Replace the version number by <code>master</code> in the URLs for the most recent Laravel version
							</li>
							<li class="fragment">
								Don't use the docs of Laravel versions < 5.0. A lot has changed.
							</li>
							
						</ul>
					</section>
				</section>


				<!-- Configuration -->
				<section>
					<section>
						<h2>Configuration</h2>
						<p><img src="assets/04/KCEX_COMICON.jpg" alt="" title="" width="547" /></p>
					</section>					

					<section>
						<h2>Next step: configuration (1)</h2>
						<ul>
							<li class="fragment">
								Directory permissions
								<ul>
									<li class="fragment"><code>storage/</code> and <code>bootstrap/cache</code> writable by web server (associated account)</li>
								</ul>
							</li>
							<li class="fragment">
								Application key (= IMPORTANT)
								<ul>
									<li class="fragment">a random and secret key, used for session security and encryption</li>
									<li class="fragment">location: <code>.env</code> environment file</li>
									<li class="fragment">assigned for you by the Composer/Laravel installer (not when you copied the project or alike)</li>
									<li class="fragment">if necessary, generate with
									<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ php artisan key:generate</code></pre></li>
								</ul>
							</li>							
						</ul>
					</section>
					
					<section>
						<h2>Next step: configuration (2)</h2>
						<ul>
							<li class="fragment">
								Additional configuration
								<ul>
									<li class="fragment">
										<code>config/app.php</code> &mdash; Main settings, locale, timezone, automatically loaded service providers, &hellip;
									</li>
									<li class="fragment">
										<code>config/database.php</code> &mdash; Database connection configurations
									</li>
									<li class="fragment">
										10 other config files e.g. <code>config/cache.php</code>, <code>config/session.php</code>, &hellip;
									</li>
									<li class="fragment">
										format: one big (nested) array of key-value pairs of settings e.g. <pre class="bigger"><code class="language-php">'charset' => 'utf8mb4',</code></pre>
									</li>
								</ul>
							</li>					
						</ul>
					</section>
					
					<section>
						<h2>CAUTION: the <a href="https://laravel.com/docs/5.3/helpers#method-env">env()</a> function</h2>
						<ul>
							<li class="fragment">
								Including environment variables in the <code>config/*.php</code> files
								<ul>
									<li class="fragment">
										the <a href="https://laravel.com/docs/5.3/helpers#method-env">env()</a> function gets the value of an environment variable or returns a default value
										<ul>
											<li class="fragment">
												Example without default value from <code>config/app.php</code>: <pre class="bigger"><code class="language-php">'key' => env('APP_KEY'),</code></pre>
											</li>
											<li class="fragment">
												Example with default value from <code>config/database.php</code>: <pre class="bigger"><code class="language-php">'password' => env('DB_PASSWORD', 'Azerty123'),</code></pre>
											</li>
										</ul>
									</li>
									<li class="fragment">
										Environment variables must/can be set in the <code>.env</code> file e.g. <pre class="bigger"><code>APP_KEY=base64:DBHbcyBbq0pBarhWVn0S8bYMqt9IV9EhXhthcyeioKw=
DB_PASSWORD=secret</code></pre>
									</li>
									<li class="fragment">This is the mechanism behind the <a href="https://laravel.com/docs/5.3/configuration#environment-configuration">Environment Configuration</a></li>
								</ul>
							</li>							
						</ul>
					</section>

					<section>
						<h2>The Environment Configuration</h2>
						<ul>
							<li class="fragment">
								Principles
								<ul>
									<li><strong>Idea:</strong> local/dev and production configurations may be different such as personal keys, Facebook Dev Credentials, e-mail component.</li>
									<li><strong>Mechanism:</strong> the <code>.env</code> file must/can be used to override settings in the <em>real config files</em><br/></li>
								</ul>
							</li>
							<li class="fragment">
								How to use
								<ul>
									<li>Put your production configuration in <code>config/*.php</code></li>
									<li>Override parts of it with local settings in <code>.env</code></li>
									<li>Keep <code>.env</code> out of version control (git &rarr; <code>.gitignore</code>). It's private. <br/> </li>
								</ul>
							</li>							
						</ul>
						<footer class="fragment"><em>Note: the application key is always in <code>.env</code></em><br><em>Note: alternative local configurations like <code>.env.testing</code> can be used by PHPUnit</em></footer>
					</section>
					
					<section>
						<h2>Example: database config (1) </h2>
						<small><code>config/database.php</code></small>
						<pre class="bigger"><code class="language-php">&lt;?php
						
return [
    &hellip;
    'default' => env('DB_CONNECTION', 'mysql'),

    'connections' => [
        'sqlite' => [
            &hellip;
        ],

        'mysql' => [
            'driver' => 'mysql',
            'host' => env('DB_HOST', 'db009.my-hosting-company.be'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'events'),
            'username' => env('DB_USERNAME', 'production'),
            'password' => env('DB_PASSWORD', 'Azerty123'),
            'charset' => 'utf8mb4',
			&hellip;</code></pre>
					</section>
					<section>
						<h2>Example: database config (2) </h2>
						<small><code>.env</code></small>
						<pre class="bigger"><code>APP_ENV=local
APP_DEBUG=true
APP_KEY=base64:DBHbcyBbq0pBarhWVn0S8bYMqt9IV9EhXhthcyeioKw=
APP_URL=http://localhost

DB_CONNECTION=sqlite</code></pre>
						<ul>
							<li class="fragment">
								You can ...
								<ul>
									<li>also override parts of the connection config (e.g. just the encoding or password)</li>
									<li>abandon the <code>DB_CONNECTION=sqlite</code> if you agree with the default connection in <code>config/database.php</code> </li>
								</ul>
							</li>
							<li class="fragment">
								but you cannot delete <code>.env</code>
							</li>							
						</ul>
					</section>

				</section>


				<!-- Laravel Routing -->
				<section>
					<section>
						<h2>Laravel Routing</h2>
						<p><img src="assets/04/idees_noires.jpg" alt="" title="" width="500" /></p>
						<p style="font-size: 75%; line-height: 100%;">Note: the next slides are illustrated in this demo: <code>assets/ws2-sws-fiddles-laravel/00.basics/</code> (<code>composer install</code> required) <a href="assets/ws2-sws-fiddles-laravel/00.basics/">&rarr;</a> <br/><span style="font-size: 50%; line-height: 100%;">It includes basic examples of routing, views, Blade templates, Raw Queries, Query Builder and Eloquent.</span></p>
					</section>

					<section>
						<h2>Routing</h2>
						<ul>
							<li class="fragment">
								All Laravel routes are defined in <code>app/Http/routes.php</code>
							</li>
							<li class="fragment">
								<a href="https://laravel.com/docs/5.3/routing#basic-routing">Router methods</a> very similar to Silex routing
							</li>
							<li class="fragment" style="margin-top: 1em">
								Router method available for any HTTP verb (get, post, put, ...)
								<pre class="bigger"><code class="language-php">Route::get('foo', function () {
    return 'Hello World';
});</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em">
								HTTP verb combinations
								<pre class="bigger"><code class="language-php">Route::match(['get', 'post'], '/', function () { &hellip;
								
Route::any('foo', function () { &hellip;</code></pre>
							</li>
						</ul>
					</section>


					<section>
						<h2>Dynamic Routing</h2>
						<ul>
							<li class="fragment">
								Working with <a href="https://laravel.com/docs/5.3/routing#route-parameters">Route
								parameters</a>
								<ul>
									<li class="fragment">The parameters will be passed into your route's Closure</li>
								</ul>
								<pre class="bigger fragment"><code class="language-php">Route::get('posts/{post}/comments/{comment}', function ($postId, $commentId) {
    return 'Post ' . $postId;
});</code></pre>
							</li>
							<li class="fragment">
								Optional parameters</a>
								<pre class="bigger fragment"><code class="language-php">Route::get('user/{name?}', function ($name = 'John') {
    return $name;
});</code></pre>
							</li>
						</ul>
						<footer class="fragment"><em>Important: in these examples we do not prevent XSS</em></footer>
					</section>

					<section>
						<h2>Regex constraints</h2>
						<ul>
							<li class="fragment">
								Constrain parameters using the <code>where</code> method
								<pre class="bigger fragment"><code class="language-php">Route::get('user/{id}/{name}', function ($id, $name) {
    //
})
->where(['id' => '[0-9]+', 'name' => '[a-zA-Z]+']);</code></pre>
							</li>
							<li class="fragment">You can add <a href="https://laravel.com/docs/5.3/routing#parameters-regular-expression-constraints">global constraints</a> too
							<ul>
								<li class="fragment">For example: for each <em>id</em> parameter in a dynamic route</li>
								<li class="fragment">Location: boot method of your RouteServiceProvider (typically <code>app/Providers/RouteServiceProvider.php</code>)</li>
							</ul>
							</li>
						</ul>

					</section>


					<section>
						<h2>The HTTP Request (1)</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/requests">HTTP Request</a>
								<ul>
									<li class="fragment">is an instance of <code>Illuminate\Http\Request</code></li>
									<li class="fragment">is typically obtained in your code by type hinting:
									<pre class="bigger fragment"><code class="language-php">use Illuminate\Http\Request;
									
Route::post('register', function(Request $request) {
	$email = $request&gt;input('email', 'not provided');
	$name = $request-&gt;cookie('name');
	$iKnowItsTrue = $request-&gt;isMethod('post');
	if ($request-&gt;has('name')) {
    &hellip;
});</code></pre>
									</li>
									<li class="fragment">the input method handles any type of input parameter: POST parameters, GET parameters, ... and even JSON input (if the Content-Type is set properly)</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
					<h2>The HTTP Request (2)</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/requests">HTTP Request</a>
								<ul>
									<li class="fragment">use a <code>.</code> to dig into arrays (whether JSON or not)</li>
										<pre class="bigger fragment"><code class="language-php">$name = $request-&gt;input('products.0.name');</code></pre>
									</li>
									<li class="fragment">dynamic properties
										<pre class="bigger fragment"><code class="language-php">$name = $request-&gt;name; // same as: $request&gt;input('name');</code></pre>
									</li>
									<li class="fragment">handling file uploads
										<pre class="bigger fragment"><code class="language-php">$files = $request-&gt;file('additional_documents');
foreach($files as $file) {
	$fileName = $file-&gt;getClientOriginalName();
	$success = $file-&gt;move($destinationPath, $fileName); // path relative to public/
}</code></pre>
									</li>									
									<li class="fragment">Want more? <a href="https://laravel.com/api/5.3/Illuminate/Http/Request.html">Request API</a></li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>The HTTP Response (1)</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/responses">HTTP Response</a>
								<ul>
									<li class="fragment">is an instance of <code>Illuminate\Http\Response</code></li>
									<li class="fragment">can be returned in your code
										<ul>
											<li class="fragment">as a string (automatic conversion): <code class="language-php">return 'Hello World';</code></li>
											<li class="fragment">as a Response object: <pre class="bigger"><code class="language-php">return (new Response($content, $status));</code></pre></li>
											<li class="fragment">idem, with helper (no use-statement needed):<pre class="bigger"><code class="language-php">return response($content, $status));</code></pre></li>
											<li class="fragment">idem, with chained methods:
									<pre class="bigger fragment"><code class="language-php">return response($content)
                ->header('Content-Type', $type)
                ->cookie('name', 'value');</code></pre>
											</li>
											
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>The HTTP Response (2)</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/responses">HTTP Response</a>
								<ul>
									<li class="fragment">is an instance of <code>Illuminate\Http\Response</code></li>
									<li class="fragment">can be returned in your code
										<ul>
											<li class="fragment">as a view: <pre class="bigger"><code class="language-php">return view('greeting', ['name' => 'James']);</code></pre> &mdash; it involves rendering the <code>resources/views/greeting.php</code> template</li>
											<li class="fragment">idem, with chained HTTP response methods: <pre class="bigger"><code class="language-php">return response()->view('greeting', $data)->&hellip;;</code></pre></li>
											<li class="fragment">as a JSON response: <pre class="bigger"><code class="language-php">return response()->json(['name' => 'Abigail', 'state' => 'CA']);</code></pre></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>		

					<section>
						<h2>The HTTP Response (3)</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/responses">HTTP Response</a>
								<ul>
									<li class="fragment">is an instance of <code>Illuminate\Http\Response</code></li>
									<li class="fragment">can be returned in your code
										<ul>
											<li class="fragment">as a forced file download: <pre class="bigger"><code class="language-php">return response()->download($pathToFile);</code></pre></li>
											<li class="fragment">as a <code>RedirectResponse</code> instance: <pre class="bigger"><code class="language-php">return redirect('home/dashboard');</code></pre></li>
											<li class="fragment">idem, after invalid form submission: <pre class="bigger"><code class="language-php">return back()->withInput();</code></pre></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</section>						


				</section>


				<!-- Views and templates -->
				<section>
					<section>
						<h2>Views and templates</h2>
					</section>
					
					<section>
						<h2>Views</h2>

						<ul>
							<li class="fragment">
								Presentation logic: "templates" stored in the <code>resources/views</code>
								<ul>
									<li class="fragment">A simple view contains inline PHP code e.g. <code>resources/views/subdir/greeting.php</code>
										<pre class="bigger"><code class="language-php">&lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;Hello, &lt;?php echo htmlentities($name); /* XSS prevention */ ?&gt;&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre></li>
									<li class="fragment">The <code>view</code> helper returns an instance of <code>Illuminate\View\View</code>, to which you can pass variables.
										<pre class="bigger"><code class="language-php">return view('subdir.greeting', ['name' => 'Eddy']);</code></pre></li>
									</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>Note: the passed variables are stored in the instance, but the view is not rendered at this point.</em></footer>
					</section>
					
					<section>
						<h2>Blade templates</h2>

						<ul>
							<li class="fragment">
								<a href="https://laravel.com/docs/5.3/blade">Blade templates</a> are views compiled by the Blade template engine
								<ul>
									<li class="fragment">File extension: <code>.blade.php</code></li>
									<li class="fragment">File location, view instantiation (omit <code>.blade.php</code>!) and variable passing: see previous slide (Views).</li> 
									<li class="fragment">Compiled into plain PHP code and cached until modified</li>
									<li class="fragment">&rarr; you will be debugging compiled views in <code>storage/framework/views</code></li>
									<li class="fragment">Blade syntax very different from Twig, but closer to PHP</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Blade syntax (1)</h2>

						<ul>
							<li class="fragment">
								Displaying data
								<pre class="bigger"><code class="language-php">Hello, {{ $name }}.</code></pre>
								<ul>
									<li class="fragment">{{ Statements }} automatically sent through <code>htmlentities</code> to prevent XSS-attacks.</li>
									<li class="fragment">Mind the <code>$</code></li> 
									<li class="fragment">Any PHP code can be included e.g. <code>{{ time() }}</code> <small>and forget about Twig filters</small></li>
									<li class="fragment"><code>{{ $name or 'Default' }}</code> is syntactic sugar for <code>{{ isset($name) ? $name : 'Default' }}</code></li>
									<li class="fragment">Unescaped statements:
									<pre class="bigger"><code class="language-php">Hello, {!! $name !!}.</code></pre></li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Blade syntax (2)</h2>

						<ul>
							<li class="fragment">
								Control structures
								<pre class="bigger"><code class="language-html">@if (count($records) === 1)
    I have one record!
@elseif (count($records) > 1)
    I have multiple records!
@else
    I don't have any records!
@endif

@foreach ($events as $event)
    &lt;p&gt;This is user {{ $event->id }}&lt;/p&gt;
@endforeach</code></pre>
								<ul>
									<li class="fragment">Structures don't work without <code>()</code></li> 
									<li class="fragment">Check the <a href="https://laravel.com/docs/5.3/blade#control-structures">docs</a> for more syntax information</li>
									<li class="fragment">Associative array by index: just <code>$event['id']</code></li> 
									<li class="fragment">Object fields: just <code>$event->id</code></li> 
									
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Blade syntax (3)</h2>

						<ul>
							<li class="fragment">
								<a href="https://laravel.com/docs/5.3/blade#template-inheritance">Template inheritance</a>: sections
								<pre class="bigger"><code class="language-html" style="max-height: 170px; overflow: scroll;">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;App Name - @yield('title')&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        @section('sidebar')
            This is the master sidebar.
        @show
        &lt;div class="container"&gt;
            @yield('content')
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
								<pre class="bigger"><code class="language-html">@extends('layouts.master')

@section('title', 'Page Title')

@section('sidebar')
    @parent
    &lt;p&gt;This is appended to the master sidebar.&lt;/p&gt;
@endsection

@section('content')
    &lt;p&gt;This is my body content.&lt;/p&gt;
@endsection</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Blade vs. clean URLs</h2>
						<ul>
							<li class="fragment">
								Linking from <code>/route1</code> to <code>/route2</code> would generate a browser link to <code>/route1/route2</code> 
								<ul>
									<li class="fragment">Use <code>{{ asset('css/common.css') }}</code> to generate a path in your template to an asset in your <code>public</code> folder</li>
									<li class="fragment">Use <code>{{ url('artists/' . $id) }}</code> to generate a path to a route</li>
									<li class="fragment">Use <code>{{ route('admin::dashboard') }}</code> to generate a path to a <a href="https://laravel.com/docs/5.3/routing#named-routes">named route</a></li>
								</ul>
							</li>
						</ul>
					</section>					

				</section>

				<!-- 4 Database features -->
				<section>
					<section>
						<h2>4 Database features</h2>
					</section>
					
					<section>
						<h2>Before we start</h2>

						<ul>
							<li class="fragment">
								Supported DBMS systems by Laravel
								<ul>
									<li class="fragment">MySQL</li>
									<li class="fragment">Postgres</li>
									<li class="fragment">SQLite</li>
									<li class="fragment">SQL Server</li>									
								</ul>
							</li>
							<li class="fragment">
								DB configuration: see <a href="#/2">previous slides on configuration</a>
								<ul>
									<li class="fragment">Note: you can have <a href="https://laravel.com/docs/5.3/database#introduction">separate configs</a> for reading/writing</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#1 Raw SQL Queries (1)</h2>

						<ul>
							<li class="fragment">
								In Laravel you can run <a href="https://laravel.com/docs/5.3/database#running-queries">raw SQL queries</a>
								<pre class="bigger"><code class="language-php">$users = DB::select('select * from users where active = ?', [1]);
								
foreach ($users as $user) {
    echo $user->name;
}</code></pre>
								<ul>
									<li class="fragment">Parameter binding prevents against <strong>SQL injection</strong></li>
									<li class="fragment"><code>DB::select</code> returns an array of <code>StdClass</code> objects with <a href="http://stackoverflow.com/questions/829823/can-you-create-instance-properties-dynamically-in-php">dynamic properties</a> (column name or SQL alias)</li>
									<li class="fragment">Named bindings
										<pre class="bigger"><code class="language-php">$results = DB::select('select * from users where id = :id', ['id' => 1]);</code></pre>
									</li>
												
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#1 Raw SQL Queries (2)</h2>

						<ul>
							<li class="fragment">
								In Laravel you can run <a href="https://laravel.com/docs/5.3/database#running-queries">raw SQL queries</a>
								
								<ul>
								
									<li class="fragment">Similar functions for insert/update/delete
										<pre class="bigger"><code class="language-php">$affected = DB::update('update users set votes = 100 where name = ?', ['John']);</code></pre>
									</li>
									<li class="fragment">General statements
										<pre class="bigger"><code class="language-php">DB::statement('drop table users');</code></pre>
									</li>									
								</ul>
							</li>
						</ul>
					</section>					
					
					<section>
						<h2>#2 Query Builder (1)</h2>

						<ul>
							<li class="fragment">
								Fluent interface for building SQL queries (<a href="https://laravel.com/docs/5.3/queries">docs</a>)
								<ul>
									<li class="fragment">Always start with <code>DB::table()</code></li>
									<li class="fragment">and use chained methods to filter/select/aggregate data</li>
									<li class="fragment">Automatic prevention against <strong>SQL injection</strong></li>
									
									<li class="fragment" style="margin-top: 1em"><code>get()</code> returns an array of results
										<pre class="bigger"><code class="language-php">$users = DB::table('users')-&gt;get();</code></pre>
									</li>
									<li class="fragment">example with <code>select()</code>, <code>where()</code> and<code>groupBy()</code>
										<pre class="bigger"><code class="language-php">$users = DB::table('users')
                     -&gt;select('name', 'email as user_email')
                     -&gt;where('status', '&lt;&gt;', 1)
                     -&gt;groupBy('status')
                     -&gt;get();</code></pre>
									</li>											
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#2 Query Builder (2)</h2>

						<ul>
							<li class="fragment">
								Fluent interface for building SQL queries (<a href="https://laravel.com/docs/5.3/queries">docs</a>)
								<ul>
									<li class="fragment"><code>first()</code> returns a single row
										<pre class="bigger"><code class="language-php">$user = DB::table('users')-&gt;where('name', 'John')-&gt;first();
echo $user-&gt;name;</code></pre>
									</li>
									<li class="fragment"><code>value()</code> returns a single value
										<pre class="bigger"><code class="language-php">$email = DB::table('users')-&gt;where('name', 'John')-&gt;value('email');</code></pre>
									</li>
									<li class="fragment"><code>pluck()</code> returns an <strong>array</strong> of custom keys and <strong>values</strong>
										<pre class="bigger"><code class="language-php">$events = DB::table('event')-&gt;pluck('name', 'id');
										
foreach ($events as $id =&gt; $name) { 
	&hellip;</code></pre>
									</li>

								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>#2 Query Builder (3)</h2>

						<ul>
							<li class="fragment">
								Fluent interface for building SQL queries (<a href="https://laravel.com/docs/5.3/queries">docs</a>)
								<ul>
									<li class="fragment">aggregate methods e.g. <code>count()</code>, <code>max()</code></li>
									<li class="fragment">much more e.g. <code>whereIn()</code>, <code>orWhere()</code>, joins e.g. <code>leftJoin()</code>, <code>on()</code> </li>		
									<li class="fragment">Examples with <code>insert()</code>, <code>update()</code> and <code>delete()</code>
										<pre class="bigger"><code class="language-php">$id = DB::table('users')->insertGetId(
    ['email' => 'john@example.com', 'votes' => 0]
);

DB::table('users')
            ->where('id', 1)
            ->update(['votes' => 1]);
			
DB::table('users')->increment('votes', 5);
		
DB::table('users')->where('votes', '&lt;', 100)->delete();
</code></pre>
									</li>
								</ul>
							</li>
						</ul>
					</section>		

					<section>
						<h2>#3 Eloquent ORM (1)</h2>

						<ul>
							<li class="fragment">
								ORM: each database table has a corresponding "Model" which is used to interact with it
							</li>
							<li class="fragment">
								First step: generate the models with Artisan (! uppercase)
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;">$ php artisan make:model <u>E</u>vent</code></pre>
								<ul>
									<li class="fragment">It generates the (pretty empty) class <code>Event</code> extending <code>Illuminate\Database\Eloquent\Model</code> in the <code>app/</code> directory</li>
									<li class="fragment">The model assumes that there is a table <code>events</code> (plural!) in the database, unless you add
<pre class="bigger"><code class="language-php">protected $table = 'my_other_table_name';</code></pre>
									</li>						
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#3 Eloquent ORM (2)</h2>

						<ul>
							<li class="fragment">
								First step: generate the models with Artisan
								<ul>
									<li class="fragment">The model assumes the table has an (auto-increment) primary key called <code>id</code>, unless you add
<pre class="bigger"><code class="language-php">protected $primaryKey = 'event_id';
protected $incrementing = false;</code></pre>
									</li>
									<li class="fragment">The model assumes that the table has <code>created_at</code> and <code>updated_at</code> columns, unless you add
<pre class="bigger"><code class="language-php">public $timestamps = false;</code></pre>
										<ul>
											<li class="fragment">Eloquent will automatically update these columns when creating/changing data</li>
											<li class="fragment">Raw SQL Queries won't</li>						
										</ul>
									</li>								
								</ul>
							</li>
						</ul>
					</section>		

					<section>
						<h2>#3 Eloquent ORM (3)</h2>

						<ul>
							<li class="fragment">
								From now on, you can filter/select/aggregate data using the model
								<ul>
									<li class="fragment">Eloquent's <code>all()</code> returns all records in the table
<pre class="bigger"><code class="language-php">use App\Event;

$events = Event::all();</code></pre>
									</li>
									<li class="fragment">Rely on Query Builder for many other (chained) methods
<pre class="bigger"><code class="language-php">use App\Event;

$events = Event::where('active', 1)
               -&gt;orderBy('name', 'desc')
               -&gt;get();</code></pre>
									</li>								
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#3 Eloquent ORM (4)</h2>

						<ul>
							<li class="fragment">
								You can insert, update and delete rows correspondingly to the <a href="https://en.wikipedia.org/wiki/Active_record_pattern">active record pattern</a>
								<ul>
									<li class="fragment">This means that an object instance is tied to a single row in the table
									</li>							
								<pre class="bigger"><code class="language-php">use App\Event;

$event = new Event;
$event-&gt;name = $request->name;
$event-&gt;save();

$event = Event::find(1);
$event-&gt;name = 'Pukkelpop 2016';
$event-&gt;save();

$event-&gt;delete();
</code></pre>
									<li class="fragment">But the Query Builder examples with <code>insert()</code>, <code>update()</code> and <code>delete()</code> will work too.
									</li>							
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>#3 Eloquent ORM (5)</h2>

						<ul>
							<li class="fragment">
								Mass assignment
								<ul>
									<li class="fragment">Definition: use the create method to save a new model in a single line
									<pre class="bigger"><code class="language-php">$user = App\User::create(['name' =&gt; 'Franky Pallemans', 'company' =&gt; 'Cynalco']);</code></pre>
									</li>
									<li class="fragment">It enables to pass all parameter/value-pairs of the HTTP request's querystring to the create method
									<pre class="bigger"><code class="language-php">$user = App\User::create($request-&gt;all());</code></pre>
									</li>
									<li class="fragment"><strong>Mass-assignment vulnerability</strong>: a malicious user adds a parameter to the HTTP request e.g. <code>role=administrator</code> which is passed to the create method
									</li>						
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#3 Eloquent ORM (6)</h2>

						<ul>
							<li class="fragment">
								Mass assignment vulnerability protection
								<ul>
									<li class="fragment">It is required to
										<ul>
											<li class="fragment">blacklist: <code>protected $guarded = ['role'];</code>
											</li>
											<li class="fragment">or whitelist: <code>protected $fillable = ['name', 'company'];</code>
											</li>												
										</ul>
									  the mass assignable attributes in the model class
									</li>
									
									<li class="fragment">Attention: when you pass a blacklisted/not-whitelisted parameter to the create method
										<ul>
											<li class="fragment">You don't get an error
											</li>
											<li class="fragment">Laravel just drops that parameter</code>
											</li>												
										</ul>
									</li>
									<li class="fragment">It only applies to create so you can still
									<pre class="bigger"><code class="language-php">$user-&gt;role = 'administrator';
$event-&gt;save();</code></pre>
									</li>
								
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#3 Eloquent ORM (7)</h2>

						<ul>
							<li class="fragment">
								Eloquent relationships
								<ul>
									<li class="fragment">Suppose a 1:n relation between <em>users</em> and <em>tasks</em> &rarr; table <em>tasks</em> has a foreign key
									</li>
									<li class="fragment">Instead of working with FKs, you want to interact with the related objects directly
										<pre class="bigger"><code class="language-php">$user = App\User::find(1);

foreach ($user-&gt;tasks as $task) {
    echo $task-&gt;name;
}
</code></pre>
									</li>						
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>#3 Eloquent ORM (8)</h2>

						<ul>
							<li class="fragment">
								Eloquent relationships
								<ul>
									</li>
									<li class="fragment">Solution, part 1: add* to the <code>User</code> class: (! plural)
										<pre class="bigger"><code class="language-php">public function tasks()
{
        return $this-&gt;hasMany(Task::class);
}
</code></pre>
									</li>
									
<li class="fragment">Solution, part 2: add* to the <code>Task</code> class:
										<pre class="bigger"><code class="language-php">public function user()
{
        return $this-&gt;belongsTo(User::class);
}
</code></pre>
									</li>

									<li class="fragment">Read the <a href="https://laravel.com/docs/5.3/eloquent-relationships">docs on Eloquent relationships</a> to learn about other types of relationships
									</li>							
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>* this code assumes a correct foreign key relation</em></footer>
					</section>

					<section>
						<h2>Working with dates and times</h2>

						<ul>
							<li class="fragment">
								Laravel comes with <a href="http://carbon.nesbot.com/docs/">Carbon</a><pre class="bigger"><code class="language-php">use Carbon\Carbon;</code></pre>
								<ul>
									<li class="fragment">The Carbon class extends the PHP <a href="http://www.php.net/manual/en/class.datetime.php">DateTime</a> class
									</li>
									<li class="fragment">You can use it as part of a query
										<pre class="bigger"><code class="language-php">$events = Event::where('event_date', '<', new Carbon('yesterday 23:10'))-&gt;get();
</code></pre>
									</li>
									<li class="fragment">In order to have a Carbon object auto-casted at any time in Eloquent, you need to tell Eloquent first
										<pre class="bigger"><code class="language-php">class Event extends Model
{
	// keep the default date fields created_at and updated_at !
    protected $dates = ['created_at', 'updated_at', 'event_date']; 
}
</code></pre>
									</li>
									<li class="fragment">Now you can do things like <code>$event-&gt;event_date = Carbon::now();</code></li>
								</ul>
							</li>
						</ul>
					</section>					

					<section>
						<h2>#4 Migrations (1)</h2>

						<ul>
							<li class="fragment">
								Typical dev team situation
								<ul>
									<li class="fragment">All team members have a local (test) instance of the database </li>
									<li class="fragment">From time to time the DB schema is modified</li>
									<li class="fragment">How can we easily share these changes?
									<ul>
									<li class="fragment">By changing the global SQL-dump and put it to version control? Maybe, but it doesn't scale </li>		
									<li class="fragment">By adding an SQL-update file and put it to version control? Maybe, but it is difficult to produce and it is not structured</li>
									</ul></li>
								</ul>
							</li>
							<li class="fragment">
								Solution: Database Migrations
								<ul>
									<li class="fragment">Easily modify and share the application's database schema. </li>
									<li class="fragment">It's like version control for your DB</li>
									
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#4 Migrations (2)</h2>

						<ul>
							<li class="fragment">
								How does it work?
								<ul>
									<li class="fragment">A modification to the DB schema is described in a migration class file, named with a timestamp, located in <code>database/migrations</code> </li>
									<li class="fragment">A migration class contains two methods: <code>up</code> (perform migration) and <code>down</code> (reverse).</li>
									<li class="fragment">These modification are programmed with Laravel schema builder </li>
									<li class="fragment" style="margin-top: 1em">Artisan helps you to create blueprints of migration classes </li>
									<li class="fragment">Put successful migrations to version control </li>
									<li class="fragment">In one Artisan command, you can execute all migrations that have not been executed before (logged in the DB table <code>migrations</code>)</li>
								</ul>
							</li>

							<li class="fragment">
								Read more about it in the <a href="https://laravel.com/docs/5.3/migrations">Laravel docs on Migrations</a>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#4 Migrations (3)</h2>

						<ul>
							<li class="fragment">
								Example: table creation
								<pre class="bigger"><code class="language-bash dontrun">$ php artisan make:migration create_events_table --create=events</code></pre>
								<ul>
									<li class="fragment">generates <code>database/migrations/&lt;timestamp&gt;_create_events_table.php</code>
<pre class="bigger"><code class="language-php">class CreateEventsTable extends Migration
{
    public function up()
    {
        Schema::create('events', function (Blueprint $table) {
            $table-&gt;increments('id'); // your table has a PK auto-inc id column
            $table-&gt;timestamps(); // your table has created_at and updated_at columns
        });
    }

    public function down()
    {
        Schema::drop('events');
    }
}</code></pre>
									</li>						
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>#4 Migrations (4)</h2>

						<ul>
							<li class="fragment">
								Example: table creation
								<ul>
									<li class="fragment">complete the schema creation
<pre class="bigger"><code class="language-php">public function up()
{
	Schema::create('events', function (Blueprint $table) {
		$table-&gt;increments('id'); // LEAVE IT HERE
		$table-&gt;string('title');
		$table-&gt;text('description');
		$table-&gt;date('event_date');
		
		// foreign key: column types need to be EXACTLY the same
		$table-&gt;integer('location_id')-&gt;unsigned(); // 
		$table-&gt;foreign('location_id')-&gt;references('location_id')-&gt;on('locations');
		
		$table-&gt;timestamps(); // LEAVE IT HERE
	});
}</code></pre>
									</li>
									<li class="fragment">run all migrations
<pre class="bigger"><code class="language-bash">$ php artisan migrate</code></pre>
									</li>											
								</ul>
							</li>
						</ul>
					</section>					
					
					<section>
						<h2>Migrations bug with MySQL utf8mb4</h2>

						<ul>
							<li class="fragment" style="font-size: 80%">
								The <a href="http://aoverton.com/web-development/using-mysql-utf8mb4-with-laravel-5/">problem</a>
								<ul>
									<li class="fragment">Definition of string columns with Migrations<pre class="bigger"><code class="language-php">$table-&gt;string('name');
$table-&gt;string('email')-&gt;unique();
</code></pre></li>
									<li class="fragment">Default string length in Laravel's Schema Builder: 255 chars</li>
									<li class="fragment">With utf8mb4: 255 * 4 = 1020 bytes</li>
									<li class="fragment">Max length: 1000 bytes for MyISAM, 767 bytes for InnoDB<pre><code class="language-bash">[Illuminate\Database\QueryException] SQLSTATE[42000]: Syntax error or access violation: 1071 Specified key 
was too long; max key length is 767 bytes (SQL: alter table `users` add unique users_email_unique(`email`))
</code></pre></li>
									
								</ul>
							</li>
							<li class="fragment" style="font-size: 80%">
								Solutions
								<ul>
									<li class="fragment">Best: correct string lengths<pre class="bigger"><code class="language-php">$table-&gt;string('name', 191);
$table-&gt;string('email', 191)-&gt;unique();
</code></pre></li>
									<li class="fragment">Good: just use <em>utf8</em> (= 3-byte-encoding) for your DB</li>
									<li class="fragment">
										Bad: replace <em>utf8mb4</em> by <em>utf8</em> in <code>config/database.php</code> 
										&rarr; you're fooling the system
									</li>
								</ul>
							</li>

						</ul>
					</section>
					
					<section>
						<h2>Combining #3 and #4</h2>

						<ul>
							<li class="fragment">
								Migrations and Eloquent: typical flow
								<pre class="bigger"><code class="language-bash dontrun" style="max-height: 380px; overflow: scroll;"># start from an empty DB
								
$ php artisan make:migration create_table_products --create=products

# migration contains: $table-&gt;increments('id');
# migration contains: $table-&gt;timestamps();
# add to your migration: other columns

$ php artisan migrate

$ php artisan make:model Product

# add to your model: mass-assignable blacklist/whitelist

# use App\Product wherever you want for your DB operations</code></pre>
							</li>

						</ul>
						<footer class="fragment"><em>Note: Laravel comes with a pre-installed (extensible) migration and model for a <code>users</code> table </em></footer>
					</section>		

				</section>
				
				
				<section>
					<section>
						<h2>Building MVC apps</h2>
					</section>
					
					<section>
						<h2>MVC in Laravel: overview</h2>
						<p><img src="assets/04/mvc_diagram_with_routes.png" alt="" title="" width="600" style="background-color:white;" />
						<div style="font-size: 50%; line-height: 100%;margin-top: -1em;">
							Source: <a href="https://selftaughtcoders.com/from-idea-to-launch/lesson-17/laravel-5-mvc-application-in-10-minutes/">selftaughtcoders.com</a></span>
						</p>
					</section>

					<section>
						<h2>MVC in Laravel: overview</h2>
						<ul>
							<li class="fragment"><strong>Models</strong>: generate Eloquent models with Artisan</li>
							<li class="fragment" style="margin-top: 1em;"><strong>Views</strong>: store your Blade (or PHP) templates in <code>resources/views</code> </li>
							<li class="fragment" style="margin-top: 1em;"><strong>Controllers</strong>: see next slide(s)</li>							
						</ul>
					</section>

					<section>
						<h2>HTTP Controllers (1)</h2>

						<ul style="font-size: 80%">
							<li class="fragment">Create a <code>*Controller</code> in the folder <code>app/Http/Controllers</code> 
								<pre class="bigger fragment"><code class="language-bash dontrun">php artisan make:controller TaskController</code></pre>
							</li>
							<li class="fragment">
								Point to its <strong>methods</strong> in <code>app/Http/routes.php</code>
								<pre class="bigger fragment"><code class="language-php">Route::get('/tasks', 'TaskController@index');
Route::post('/task', 'TaskController@store');
Route::delete('/task/{task}', 'TaskController@destroy');</code></pre>
							</li>
							<li class="fragment">
								Write the appropriate method(s) in <code>*Controller</code>
								<pre class="bigger fragment"><code class="language-php">class TaskController extends Controller
{
	public function index(Request $request)
    {
		$tasks = Task::where('user_id', $request-&gt;input('user_id'))
                    -&gt;orderBy('created_at', 'asc')
                    -&gt;get();
        return view('tasks.index', ['tasks' =&gt; $tasks]);
    }
	
	public function destroy(Request $request, $id) </code></pre>
							</li>
						</ul>
					</section>  
					
					<section>
						<h2>HTTP Controllers (2)</h2>

						<ul style="font-size: 80%">
							<li class="fragment">
								Only include the (type-hinted) $request parameter when needed
								<pre class="bigger fragment"><code class="language-php">class TaskController extends Controller
{
	public function index()
    {
        return view('tasks.index');
    }</code></pre>
							</li>
							<li class="fragment">
								<a href="routing#route-model-binding">Implicit model binding:</a> Eloquent will use the <code>id</code> column
								<pre class="bigger fragment"><code class="language-php">Route::delete('/task/{task}', 'TaskController@destroy');</code></pre>
								<pre class="bigger fragment"><code class="language-php">class TaskController extends Controller
{
	&hellip;
	public function destroy(Request $request, Task $task) // implicit model binding (on ID)
	{
		$task-&gt;delete();
		return redirect('/tasks');
    }</code></pre>
							</li>
						</ul>
						<footer class="fragment" style="line-height: 100%;"><em>Override the model's <code>getRouteKeyName()</code> in order to use another column for this</em></footer>
						
					</section> 

					<section>
						<h2>Repositories (1)</h2>

						<ul>
							<li class="fragment">Do we need repositories in Laravel?
								<ul>
								    <li class="fragment">Not necessarily</li>
									<li class="fragment" style="margin-top: 1em;">Eloquent ORM models already form a DAL layer (= M of MVC)</li>
									<li class="fragment" style="margin-top: 1em;">Use Laravel's repositories just for complex queries you'd call from multiple locations in your code (cf. code reuse)</li>
								</ul>
							</li>
						</ul>
					</section>					
					
					<section>
						<h2>Repositories (2)</h2>

						<ul>
							<li class="fragment">Create the <code>app/Repositories</code> directory and add a <code>*Repository</code> class yourself
								<pre class="bigger fragment"><code class="language-php dontrun">&lt;?php
namespace App\Repositories; // there is PSR-4 autoloading ...

use App\Task;

class TaskRepository
{
    public function forUserId($id)
    {
        return Task::where('user_id', $id)
                    -&gt;orderBy('created_at', 'asc')
                    -&gt;get();
    }
	&hellip;
}</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Repositories (3)</h2>

						<ul>
							<li class="fragment">
								Inject the repository in the corresponding <code>*Controller</code>
								<pre class="bigger fragment"><code class="language-php">namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use App\Repositories\TaskRepository;

class TaskController extends Controller
{
    protected $tasks;

    public function __construct(TaskRepository $tasks)
    {
        $this-&gt;tasks = $tasks;
    }

    public function index(Request $request)
    {
        return view('tasks.index', [
            'tasks' =&gt; $this-&gt;tasks-&gt;forUserId($request-&gt;input('user_id'))
        ]);
    }
	&hellip;
}</code></pre>
							</li>
						</ul>
					</section>

				
					
				</section>				
				
				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						
						
						<ul> 
							<li><a href="https://laravel.com/docs/5.3/installation">Laravel docs: Installation</a></li>
							<li><a href="https://laravel.com/docs/5.3/configuration">Laravel docs: Configuration</a></li>
							<li><a href="https://scotch.io/tutorials/understanding-laravel-environment-variables">Tutorial on environment config</a></li>
							<li><a href="https://laravel.com/docs/5.3/structure">Laravel docs: Application structure</a></li>
							<li><a href="https://laravel.com/docs/5.3/routing">Laravel docs: Routing</a></li>
							<li><a href="https://laravel.com/docs/5.3/responses">Laravel docs: Responses</a></li>
							<li><a href="https://laravel.com/docs/5.3/views">Laravel docs: Views</a></li>
							<li><a href="https://laravel.com/docs/5.3/blade">Laravel docs: Blade Templates</a></li>
							<li><a href="https://laravel.com/docs/5.3/database">Laravel docs: Databases: Getting Started</a></li>
							<li><a href="https://laravel.com/docs/5.3/queries">Laravel docs: Database: Query Builder</a></li>
							<li><a href="https://laravel.com/docs/5.3/eloquent">Laravel docs: Eloquent: Getting Started</a></li>
							<li><a href="https://laravel.com/docs/5.3/migrations">Laravel docs: Migrations</a></li>
							<li><a href="https://laravel.com/docs/5.3/quickstart">Laravel tutorial on a task list project - basic</a></li>
							<li><a href="https://laravel.com/docs/5.3/quickstart-intermediate">Laravel tutorial on a task list project - intermediate</a></li>
							
							<li><a href="https://laravel.com/docs/5.3/controllers">Laravel docs: Controllers</a></li>
							<li><a href="https://laravel.com/docs/5.3/routing#route-model-binding">Laravel docs: Route Model Binding</a></li>
							<li><a href="https://laravel.com/docs/5.3/lifecycle">Laravel docs: Request Lifecycle</a></li>
							<li><a href="https://laravel.com/docs/5.3/providers">Laravel docs: Service Providers</a></li>
							<li><a href="https://laravel.com/docs/5.3/container">Laravel docs: Service Container</a></li>
						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>