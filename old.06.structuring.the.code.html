<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Web Development &mdash; Backend Development</title>

		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">
		<style>
			html, body {
				background: #34afbd;
				background: -moz-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%,#34afbd), color-stop(100%,#1c1e20));
				background: -webkit-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -o-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -ms-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				letter-spacing: 0em;
			}

			#reveal nav {
				opacity: 0.3;
				letter-spacing: -0.02em;
			}
		</style>
	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- Title -->
				<section>
					<section>
						<h3 class="inverted">Backend Development <small>[JLW506]</small></h3>
						<h1>06.Structuring the code</h1>

						<footer>
							<em>Course materials: <a href="http://www.bram.us/">Bram(us) Van Damme</a> &mdash; Lecturer: <a href="mailto:joris.maervoet@odisee.be">Joris Maervoet</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>
				</section>
				
				<!-- Presentation overview -->
				<section>
					<section>
						<h2>Presentation overview</h2>
					</section>

					<section>
						<h2>Silex: The need for structure</h2>
						<ul>
							<li class="fragment">
								As per usual, we like our code clean
								<ol>
									<li class="fragment">Don't overload <code>app.php</code> with routing logic</li>
									<li class="fragment">Don't overload <code>bootstrap.php</code> with dependency injections</li>
								</ol>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Solutions
								<ol>
									<li class="fragment">ControllerProviders<small><a href="http://silex.sensiolabs.org/doc/providers.html#controllers-providers">&#9873;</a></small></li>
									<li class="fragment">ServiceProviders<small><a href="http://silex.sensiolabs.org/doc/providers.html#service-providers">&#9873;</a></small></li>
								</ol>
							</li>
							<li class="fragment" style="margin-top: 1em;font-size: 80%;">
								Can we realize an MVC architecture with ControllerProviders and ServiceProviders?
							</li>
						</ul>
					</section>
				</section>

				
				<!-- Structured Routing -->
				<section>
					<section>
						<h2>Structured Routing using Route Controllers</h2>

						<p><img src="assets/old.03/futurama_sort.png" alt="" title="" width="447" /></p>
						<q>Number 1.0, I hereby petition you<br />for an emergency sort-and-file!</q>
					</section>

					<section>
						<h2>Base Example</h2>

						<figure><img src="assets/old.03/example-03.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at the files in  <br /><code>assets/ws2-sws-fiddles-silex/03.tweets/</code> <a href="assets/ws2-sws-fiddles-silex/03.tweets/">&rarr;</a></p>
					</section>

					<section>
						<h2>Example Analysis (1)</h2>

						<ul>
							<li class="fragment">
								Pass extra data to handling functions with <code>use</code><small><a href="http://silex.sensiolabs.org/doc/usage.html#example-get-route">&#9873;</a></small>
								<pre class="bigger fragment"><code class="language-php">$app->get('/tweets', function(Silex\Application $app) use ($tweets) {
	$output = '&lt;ul&gt;';
	foreach ($tweets as $tweet) {
		$output .= '&lt;li&gt;&lt;a href=&quot;' . $app['request']->getBaseUrl(). '/tweets/'
				. $app->escape($tweet['id']) . '&quot;>&amp;para;&lt;/a&gt; '
				. $app->escape($tweet['text']) . '&lt;/li&gt;';
	}
	$output .= '&lt;/ul&gt;';
	return $output;
});</code></pre>
							</li>
							<li class="fragment">
								Trigger errors with <code>$app->abort()</code><small><a href="http://silex.sensiolabs.org/doc/usage.html#dynamic-routing">&#9873;</a></small>
								<pre class="bigger fragment"><code class="language-php">$app->get('/tweets/{id}', function(Silex\Application $app, $id) use ($tweets) {
	if (!in_array($id, array_column($tweets, 'id'))) {
		$app->abort(404, "Tweet $id does not exist");
	}
	...
})->assert('id', '\d+');</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example Analysis (2)</h2>

						<ul>
							<li class="fragment">
								Codebase doesn't scale well
								<ul>
									<li class="fragment">What if we need to define more logic/routes?<br />&rarr; <code>/app/app.php</code> will quickly become one cluttered mess</li>
									<li class="fragment">Solution: Organize our routes in a <strong>ControllerCollection</strong></li>
								</ul>
							</li>
							<!--li class="fragment" style="margin-top: 1em;">
								Building strings of HTML in your PHP is plain stupid
								<ul>
									<li class="fragment">Solution: introduce Twig or the like</li>
								</ul>
							</li-->
						</ul>
						<footer class="fragment"><em>Note: Building strings of HTML in your PHP is plain stupid - use Twig instead</em></footer>
					</section>

					<section>
						<h2>Route Controllers (1)</h2>
						<ul>
							<li class="fragment">
								Group routes in a <code>ControllerCollection</code><small><a href="http://silex.sensiolabs.org/doc/organizing_controllers.html">&#9873;</a></small>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Mount the <code>ControllerCollection</code> instance onto a <em>base route</em>
								<pre class="bigger fragment"><code class="language-php">// define controller for a blog
$blog = $app['controllers_factory'];

$blog->get('/', function () {
	return 'Blog home page';
});
$blog->get('/{id}', function () {
	return 'Blog detail page';
})->assert('id', '\d+');

// Mount the blog controller onto the /blog route
$app->mount('/blog', $blog);</code></pre>
							</li>
						</ul>
						<footer class="fragment">Note: <code>$app['controllers_factory']</code> returns a new <code>ControllerCollection</code> instance</footer>
					</section>

					<section>
						<h2>Route Controllers (2)</h2>
						<ul>
							<li class="fragment">
								Structure is still lacking with just <code>ControllerCollection</code>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								We've talked about structure before
								<ul>
									<li class="fragment">
										&hellip; right?
									</li>
									<li class="fragment" style="position: relative;">
										Right! <a href"01.libraries.html#/3">Classes, and namespaces, and PSR-0</a>!
									</li>
								</ul>
							</li>
						</ul>
						<p class="fragment" style="position: absolute; top: 45%; left: 10%; right: 10%; bottom: 10%; transform: rotate(2deg);"><img src="assets/old.03/picard_notagain.jpg" style="width: 400px;" /></p>
						<p class="fragment" style="position: absolute; top: 45%; left: 5%; right: 10%; bottom: 10%; transform: rotate(-3deg);"><img src="assets/old.03/picard_engage.jpg" style="width: 400px;" /></p>
					</section>

					<section>
						<h2>Route Controllers (3)</h2>

						<ul>
							<li class="fragment">
								Silex' structured answer: ControllerProviders<small><a href="http://silex.sensiolabs.org/doc/providers.html#controller-providers">&#9873;</a></small> in which you wrap a <code>ControllerCollection</code>
								<ul>
									<li class="fragment">If we namespace our own controllerproviders properly, we'll have a good structure</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Revised Example</h2>

						<figure><img src="assets/old.03/example-04.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at the files in <br /><code>assets/ws2-sws-fiddles-silex/04.tweets-organized/</code> <a href="assets/ws2-sws-fiddles-silex/04.tweets-organized/">&rarr;</a></p>
					</section>

					<section>
						<h2>Example Recap (1)</h2>

						<ol>
							<li class="fragment">
								Create a namespace of your own
								<ul>
									<li class="fragment">
										Place your namespace in <code>/src</code>
									</li>
									<li class="fragment">
										Autoload your namespace by adjusting <code>composer.json</code>
										<pre class="bigger fragment"><code class="language-js dontrun">{
	&quot;require&quot;: {
		&quot;silex/silex&quot;: &quot;~1.1&quot;
	},
	&quot;autoload&quot;: {
		&quot;psr-0&quot;: {
			&quot;Ikdoeict&quot;: &quot;src/&quot;
		}
	}
}</code></pre>
									</li>
									<li class="fragment">
										Important: Run <code>composer update</code> if you've already run <code>composer install</code>
									</li>
								</ul>
							</li>
						</ol>
					</section>

					<section>
						<h2>Example Recap (2)</h2>

						<ol start="2">
							<li class="fragment">
								Create a ControllerProvider per group of routes
								<ul>
									<li class="fragment">
										The class must implement <code>Silex\ControllerProviderInterface</code>
									</li>
									<li class="fragment">
										Name of the class can be chosen freely, though something like <code>TweetsController</code> recommended
									</li>
									<li class="fragment">
										Place the file in <code>/src/<em>Namespace</em>/Provider/Controller</code>
									</li>
									<li class="fragment">
										The <code>connect</code> function regulates the (sub)routes to other instance functions
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Mount your class on the subroute from <code>/app/app.php</code>
								<pre class="bigger fragment"><code class="language-php">$app->mount('/tweets', new Ikdoeict\Provider\Controller\TweetsController());</code></pre>
							</li>
						</ol>
					</section>

				</section>

				


				<!-- Services in Silex -->
				<section>
					<section>
						<h2>Services in Silex</h2>

						<p><img src="assets/old.04/futurama_service.png" alt="" title="" width="447" /></p>
						<q>Final boarding call for Flight 406, non-stop service to pain!</q>
					</section>

					<section>
						<h2>ServiceProvider (1)</h2>
						<p>From the Silex Docs:</p>
						<blockquote class="fragment">This is very straight forward, just create a new class that implements two methods. In the <code>register()</code> method, you can define services on the application which then may make use of other services and parameters. In the <code>boot()</code> method, you can configure the application, just before it handles a request.</blockquote>
					</section>

					<section>
						<h2>ServiceProvider (2)</h2>
						<ul>
							<li class="fragment">
								Cfr. <code>ControllerProvider</code> but different interface/methods
								<pre class="bigger"><code class="language-php">namespace MyNamespace\Provider\Service;

use Silex\Application;
use Silex\ServiceProviderInterface;

class WhateverServiceProvider implements ServiceProviderInterface {

	public function register(Application $app) {
		// Store the service on Pimple
		$app['whatever'] = $app-&gt;share(function() {
			return new Whatever();
		}
	}

	public function boot(Application $app) { &hellip; }

}</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em">
								Place your class in <code>/src/MyNamespace/Provider/Service</code>
							</li>
							<li class="fragment">
								Register your class with Silex' <code>$app</code> using
								<pre class="bigger"><code class="language-php">$app->register(new MyNamespace\Provider\Service\WhateverServiceProvider(), []);</code></pre></li>
						</ul>
					</section>

					<section>
						<h2>Revised Example (1/2)</h2>
						<ol>
							<li class="fragment">
								Create the service (<code>FacebookServiceProvider.php</code>)
								<pre class="bigger"><code class="language-php">&lt;?php

namespace Ikdoeict\Provider\Service;

use Silex\Application;
use Silex\ServiceProviderInterface;

class FacebookServiceProvider implements ServiceProviderInterface {

	public function register(Application $app) {
		$app['facebook'] = $app-&gt;share(function() use ($app) {
			return new \Facebook(array(
				'appId' =&gt; $app['facebook.app_id'],
				'secret' =&gt; $app['facebook.secret']
			));
		});
	}

	public function boot(Application $app) {}

}</code></pre>
							</li>
						</ol>
					</section>

					<section>
						<h2>Revised Example (2/2)</h2>
						<ol staart="2">
							<li class="fragment">
								Register the service (<code>bootstrap.php</code>)
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Ikdoeict\Provider\Service\FacebookServerProvider(), array(
	'facebook.app_id' =&gt; 'YOUR_APP_ID',
	'facebook.secret' =&gt; 'YOUR_APP_SECRET'
));</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Use the service (<code>app.php</code>)
								<pre class="bigger"><code class="language-php">$app-&gt;get('/', function(Silex\Application $app) {
	$user = $app['facebook']->getUser();
	return $app-&gt;json($user);
});</code></pre>
							</li>
						</ol>
					</section>

					<section>
						<h2>More examples</h2>
						<ul>
							<li class="fragment"><a href="http://php-and-symfony.matthiasnoback.nl/2012/02/silex-creating-a-service-provider-for-buzz/">Silex: creating a service provider for Buzz</a></li>
							<li class="fragment" style="margin-top: 1em;">
								<a href="https://github.com/EmanueleMinotto/FakerServiceProvider">Service Provider for Faker</a>
								<ul>
									<li>Note: Faker has a Singleton pattern implemented. No need for a shared service definition</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">&hellip;</li>
						</ul>
					</section>

				</section>


				<!-- Built-in Service Provider: Twig -->
				<section>
					<section>
						<h2>Built-in Service Provider:<br />TwigServiceProvider (recap)</h2>

						<p><img src="assets/old.04/splash-twig.jpg" width="580" alt="" /></p>
					</section>

					<section>
						<h2>TwigServiceProvider</h2>
						<ul>
							<li class="fragment">TwigServiceProvider<small><a href="http://silex.sensiolabs.org/doc/providers/twig.html">&#9873;</a></small> provides Twig integration</li>
						</ul>
					</section>

					<section>
						<h2>Inclusion &amp; Usage</h2>
						<ul>
							<li class="fragment">
								Require Twig via Composer
								<pre class="bigger"><code>$ composer require twig/twig:~1.8</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register the service in <code>bootstrap.php</code>
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Silex\Provider\TwigServiceProvider(), array(
	'twig.path' =&gt; __DIR__ . '/views',
));</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Usage
								<pre class="bigger"><code class="language-php">$app-&gt;get('/hello/{name}', function ($name) use ($app) {
	return $app['twig']-&gt;render('hello.twig', array(
		'name' =&gt; $name,
	));
});</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example</h2>

						<figure><img src="assets/old.04/example-05.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at <code>assets/ws2-sws-fiddles-silex/05.tweets-twig/</code> <a href="assets/ws2-sws-fiddles-silex/05.tweets-twig/">&rarr;</a></p>
					</section>

					<section>
						<h2>Example Recap</h2>

						<ul>
							<li class="fragment">
								Place your templates in <code>/src/views/</code>
								<ul>
									<li class="fragment">
										Use subfolders per entity
										<ul>
											<li><code>/src/views/errors/</code>: <code>404.twig</code></li>
											<li><code>/src/views/tweets/</code>: <code>overview.twig</code> &amp; <code>detail.twig</code></li>
											<li><code>/src/views</code>: <code>layout.twig</code></li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">In PHP use <code>$app['twig']</code></li>
							<li class="fragment" style="margin-top: 1em;">
								The serviceprovider injects some vars into templates
								<ul>
									<li>e.g. <code>{{ app.request.baseUrl }}</code></li>
								</ul>
							</li>
						</ul>
					</section>

				</section>


				<!-- Built-in Service Provider: Swift -->
				<section>
					<section>
						<h2>Built-in Service Provider:<br />SwiftServiceProvider</h2>

						<p><img src="assets/old.04/splash-swiftmailer.png" width="280" alt="" style="margin-top: 2em" /></p>
					</section>

					<section>
						<h2>SwiftServiceProvider</h2>
						<ul>
							<li class="fragment">SwiftServiceProvider<small><a href="http://silex.sensiolabs.org/doc/providers/swiftmailer.html">&#9873;</a></small> provides SwiftMailer integration</li>
						</ul>
					</section>

					<section>
						<h2>Inclusion</h2>
						<ul>
							<li class="fragment">
								Require SwiftMailer via Composer
								<pre class="bigger"><code>$ composer require swiftmailer/swiftmailer:~5.0</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register the service in <code>bootstrap.php</code>
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Silex\Provider\SwiftmailerServiceProvider(), array(
	'swiftmailer.options' =&gt; array(
		'host' =&gt; 'host',
		'port' =&gt; '25',
		'username' =&gt; 'username',
		'password' =&gt; 'password',
		'encryption' =&gt; null,
		'auth_mode' =&gt; null
	)
));</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Usage</h2>
						<ul>
							<li class="fragment">
								Usage
								<pre class="bigger"><code class="language-php">$app-&gt;post('/feedback', function () use ($app) {
	$request = $app['request'];

	$message = \Swift_Message::newInstance()
		-&gt;setSubject('[YourSite] Feedback')
		-&gt;setFrom(array('noreply@yoursite.com'))
		-&gt;setTo(array('feedback@yoursite.com'))
		-&gt;setBody($request->get('message'));

	$app['mailer']-&gt;send($message);

	return new Response('Thank you for your feedback!', 201);
});</code></pre>
							</li>
						</ul>
					</section>

				</section>


				<!-- Built-in Service Provider: Doctrine -->
				<section>
					<section>
						<h2>Built-in Service Provider:<br />DoctrineServiceProvider (recap)</h2>

						<p><img src="assets/01/splash-doctrine.jpg" width="421" alt="" style="margin-top: 3em;" /></p>
					</section>

					<section>
						<h2>DoctrineServiceProvider</h2>
						<ul>
							<li class="fragment">DoctrineServiceProvider<small><a href="http://silex.sensiolabs.org/doc/providers/doctrine.html">&#9873;</a></small> provides Doctrine DBAL integration</li>
						</ul>
					</section>

					<section>
						<h2>Inclusion</h2>
						<ul>
							<li class="fragment">
								Require Doctrine DBAL using Composer
								<pre class="bigger"><code>$ composer require doctrine/dbal:~2.2</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register the service in <code>bootstrap.php</code>
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Silex\Provider\DoctrineServiceProvider(), array(
	'db.options' =&gt; array(
		'driver' =&gt; 'pdo_mysql',
		'host' =&gt; 'localhost',
		'dbname' =&gt; 'todolist',
		'user' =&gt; 'root',
		'password' =&gt; 'Azerty123',
		'charset' =&gt; 'utf8mb4'
	)
));</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Usage</h2>
						<ul>
							<li class="fragment">
								Usage
								<pre class="bigger"><code class="language-php">$app-&gt;get('/blog/{id}', function ($id) use ($app) {
	$sql = 'SELECT * FROM posts WHERE id = ?';
	$post = $app['db']-&gt;fetchAssoc($sql, array($id));

	return  '&lt;h1&gt;' . $app-&gt;escape($post['title']) . '&lt;/h1&gt;'.
			'&lt;p&gt;' . $app-&gt;escape($post['body']) . '&lt;/p&gt;';
})-&gt;assert('id', '\d+');</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example</h2>

						<figure><img src="assets/old.04/example-06.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at <code>assets/ws2-sws-fiddles-silex/06.doctrine/</code> <a href="assets/ws2-sws-fiddles-silex/06.doctrine/">&rarr;</a></p>

						<footer><em>(Be sure to install the example properly. @see the included <code>README.md</code>)</em></footer>
					</section>

				</section>


				<!-- Patterns! -->
				<section>
					<section>
						<h2>Recognizing a pattern &hellip;</h2>

						<p><img src="assets/old.04/futurama_pattern.png" alt="" title="" width="500" /></p>
						<q>Uh oh, I think we're going in circles. I recognize that pattern of striations on that gypsum formation.</q>
					</section>

					<section>
						<h2>What we already have</h2>
						<ul>
							<li class="fragment">Front Controller &amp; Routing</li>
							<li class="fragment">Controllers per <em>entity</em></li>
							<li class="fragment">Views (templates) per <em>entity</em></li>
							<li class="fragment">Data-access entangled in our controller</li>
						</ul>
						<p class="fragment">&rarr; If we can split out our data access logic,<br />we can <em>strive</em> towards MVC</p>
					</section>

					<section>
						<h2>MVC</h2>
						<ul>
							<li class="fragment">
								Short for <strong>Model-View-Controller</strong>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Architectural pattern describing how to build your app
							</li>
							<li class="fragment" style="margin-top: 1em;">
								In a web-context:
								<ul>
									<li class="fragment">The model represents data</li>
									<li class="fragment">The view visually represents the model</li>
									<li class="fragment">The controller is the app logic: decides what the input was, and orchestrates the proper models/views</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>MVC</h2>
						<figure>
							<img src="assets/old.04/mvc.png" alt="Model View Controller" title="Model View Controller" width="800" />
							<figcaption>MVC Schematic <em>(<a href="http://www.dubberly.com/articles/model-view-controller-pattern.html">ref</a>)</em></figcaption>
						</figure>
					</section>

					<section>
						<h2>One small step &hellip;</h2>
						<ul>
							<li class="fragment">
								Splitting off data-access logic is necessary
								<ul>
									<li class="fragment">MVC would also be nice, but let's leave it for now</li>
								</ul>
							</li>
							<li class="fragment" style="padding-top: 1em;">
								The guys at <a href="http://knplabs.com/">KnpLabs</a> have created <a href="https://github.com/KnpLabs/RepositoryServiceProvider">a nice solution</a>:
								<ul>
									<li class="fragment">
										A base <code>Knp\Repository</code> class which you extend per entity
										<ul>
											<li class="fragment">Define the name of the linked table on it</li>
											<li class="fragment">Use one of the built-in <code>insert()</code>, <code>update()</code>, <code>delete()</code>, <code>find()</code>, or <code>findAll()</code> functions</li>
										</ul>
									</li>
									<li class="fragment">
										A <code>RepositoryServiceProvider</code> for use with Silex
									</li>
									<li class="fragment">
										Installation via Composer
										<pre class="bigger"><code>&quot;require&quot;: {
	&quot;knplabs/repository-service-provider&quot;: &quot;dev-master&quot;
}</code></pre>
									</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>RepositoryServiceProvider (1)</h2>
						<ul>
							<li class="fragment">
								Base <code>Knp\Repository</code> class
								<pre class="bigger"><code class="language-php" style="max-height: 380px; overflow: scroll;">&lt;?php

namespace Knp;

use Doctrine\DBAL\Connection;

abstract class Repository {

    abstract public function getTableName();

    public $db;

    public function __construct(Connection $db) {
        $this-&gt;db = $db;
    }

    public function insert(array $data) {
        return $this-&gt;db-&gt;insert($this-&gt;getTableName(), $data);
    }

    public function update(array $data, array $identifier) {
        return $this-&gt;db-&gt;update($this-&gt;getTableName(), $data, $identifier);
    }

    public function delete(array $identifier) {
        return $this-&gt;db-&gt;delete($this-&gt;getTableName(), $identifier);
    }
    public function find($id) {
        return $this-&gt;db-&gt;fetchAssoc(sprintf('SELECT * FROM %s WHERE id = ? LIMIT 1', $this-&gt;getTableName()), array((int) $id));
    }

    public function findAll() {
        return $this-&gt;db-&gt;fetchAll(sprintf('SELECT * FROM %s', $this-&gt;getTableName()));
    }
}
</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>RepositoryServiceProvider (2)</h2>
						<ul>
							<li class="fragment">
								Example class implementation
								<pre class="bigger"><code class="language-php">namespace Ikdoeict\Repository;

class TweetsRepository extends \Knp\Repository {
	public function getTableName() { return 'tweets'; }
}</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Registration of the repositories within Silex
								<pre class="bigger"><code class="language-php">$app-&gt;register(new Knp\Provider\RepositoryServiceProvider(), array(
	'repository.repositories' =&gt; array(
		'db.tweets' =&gt; 'Ikdoeict\\Repository\\TweetsRepository'
	)
));</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Usage
								<pre class="bigger"><code class="language-php">$app['db.tweets']->findAll();</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Example</h2>

						<figure><img src="assets/old.04/example-07.png" alt="" title="" width="580" class="noborder" /></figure>

						<p style="font-size: 75%">Let's take a look at <code>assets/ws2-sws-fiddles-silex/07.doctrine-organized/</code> <a href="assets/ws2-sws-fiddles-silex/07.doctrine-organized/">&rarr;</a></p>

						<footer><em>(Be sure to install the example properly. @see the included <code>README.md</code>)</em></footer>

					</section>

					<section>
						<h2>Example Recap</h2>
						<ul>
							<li class="fragment">
								Create a Repository class per entity of your app
								<ul>
									<li class="fragment">
										Place your classses in <code>/src/<em>Namespace</em>/Repository</code>
									</li>
									<li class="fragment">
										Name of class can be chosen freely, though something like <code>TweetsRepository</code> recommended
									</li>
									<li class="fragment">
										Classes must extend <code>\Knp\Provider</code>
									</li>
									<li class="fragment">
										The <code>getTableName</code> function must return the DB table name
									</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Register your repositories in your app while registering <code>RepositoryServiceProvider</code>
								<ul>
									<li>Use <code>db.</code> as a prefix</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment" style="color: #F66;"><em>Important: don't ever write queries in your ControllerProviders, but put 'm in your Repository classes!</em></footer>
					</section>

				</section>


				<!-- More? -->
				<section>
					<section>
						<h2>More Service Providers</h2>

						<p><img src="assets/old.04/futurama_notsureif.jpg" alt="" title="" width="447" /></p>
						<q>Not sure if ...</q>
					</section>

					<section>
						<h2>More built-in Service Providers</h2>
						<ul class="fragment">
							<li><a href="http://silex.sensiolabs.org/doc/providers/url_generator.html">URL Generator</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/form.html">Form</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/validator.html">Validator</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/session.html">Session</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/security.html">Security</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/monolog.html">Monolog</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/translation.html">Translation</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/http_cache.html">HTTP Cache</a></li>
						</ul>
						<footer class="fragment"><em>We'll take a closer look at these later on :)</em></footer>
					</section>

					<section>
						<h2>Other Service-Providers</h2>
						<ul>
							<li class="fragment">Check <a href="https://github.com/fabpot/Silex/wiki/Third-Party-ServiceProviders">the Silex Wiki</a>!</li>
						</ul>
					</section>

				</section>	

				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							<li><a href="http://silex.sensiolabs.org/doc/organizing_controllers.html">http://silex.sensiolabs.org/doc/organizing_controllers.html</a></li>
							<li><a href="https://igor.io/2012/11/09/scaling-silex.html">https://igor.io/2012/11/09/scaling-silex.html</a></li>
							<li><a href="https://github.com/Mparaiso/Silex-Blog-App">https://github.com/Mparaiso/Silex-Blog-App</a> (file <code>/app/routes.php</code>)</li>
							<li><a href="http://silex.sensiolabs.org/doc/services.html">http://silex.sensiolabs.org/doc/services.html</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers.html">http://silex.sensiolabs.org/doc/providers.html</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/twig.html">http://silex.sensiolabs.org/doc/providers/twig.html</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/doctrine.html">http://silex.sensiolabs.org/doc/providers/doctrine.html</a></li>
							<li><a href="http://silex.sensiolabs.org/doc/providers/swiftmailer.html">http://silex.sensiolabs.org/doc/providers/swiftmailer.html</a></li>
							<li><a href="http://www.slideshare.net/dustin.whittle/silex-from-micro-to-full-stack">http://www.slideshare.net/dustin.whittle/silex-from-micro-to-full-stack</a></li>
							<li><a href="http://www.slideshare.net/blongden/silex-the-microframework">http://www.slideshare.net/blongden/silex-the-microframework</a></li>
							<li><a href="https://github.com/fabpot/Silex/wiki/Third-Party-ServiceProviders">https://github.com/fabpot/Silex/wiki/Third-Party-ServiceProviders</a></li>
							<li><a href="http://www.dubberly.com/articles/model-view-controller-pattern.html">http://www.dubberly.com/articles/model-view-controller-pattern.html</a></li>
							

						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>