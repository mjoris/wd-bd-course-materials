<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Web Development &mdash; Backend Development</title>

		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<style>
			html, body {
				background: #34afbd;
				background: -moz-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%,#34afbd), color-stop(100%,#1c1e20));
				background: -webkit-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -o-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -ms-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				letter-spacing: 0em;
			}

			#reveal nav {
				opacity: 0.3;
				letter-spacing: -0.02em;
			}
			
			.constraints li {
				width: 25%;
				float: left;
			}
		</style>

		<link rel="stylesheet" href="lib/zenburn.css">
	</head>

	<body>

		<div id="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">


				<!-- Title -->
				<section>
					<section>
						<h3 class="inverted">Backend Development <small>[JLW506]</small></h3>
						<h1>07.authentication and forms</h1>

						<footer>
							<em>Course materials: <a href="mailto:joris.maervoet@odisee.be">Joris Maervoet</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>
				</section>

				<!-- Named and grouped routes -->
				<section>
					<section>
						<h2>Named and grouped routes</h2>

					</section>
					
					
					<section>
						<h2>Named routes</h2>

						<ul>
							<li class="fragment">
								Specify a route name using the chained method <code>name</code>
								<pre class="bigger"><code class="language-php dontrun">Route::get('user/profile', function () {
    //
})-&gt;name('profile');</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								The same with controller actions
								<pre class="bigger"><code class="language-php dontrun">Route::get('user/profile', 'UserController@showProfile')-&gt;name('profile');</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Generating URLs To Named Routes</h2>

								<pre class="bigger"><code class="language-php dontrun">// Generating URLs&hellip;
$url = route('profile');

// &hellip; for routes with parameters
$url = route('profile', ['id' =&gt; 1]);

// Generating Redirects&hellip;
return redirect()-&gt;route('profile');</code></pre>
							
					</section>
					
					
					<section>
						<h2>Route groups</h2>

						<ul>
							<li class="fragment">
								Specify a route (URI) prefix
								<pre class="bigger"><code class="language-php dontrun">Route::group(['prefix' =&gt; 'admin'], function () {
    Route::get('users', function () {
        // Matches the "/admin/users" URL
    });
    Route::get('dashboard', function () {
        // Matches the "/admin/dashboard" URL
    });
});</code></pre>
							</li>
							<li class="fragment">
								Specify wildcard sub-domain for a route group
								<pre class="bigger"><code class="language-php dontrun">Route::group(['domain' =&gt; '{account}.myapp.com'], function () {
    Route::get('user/{id}', function ($account, $id) {
        // 
    });
});</code></pre>
							</li>
						</ul>
						<footer class="fragment"><em>You should combine this with controllers (second argument of router method)</em></footer>
					</section>					
				</section>					

				<!-- Middleware -->
				<section>
					<section>
						<h2>Middleware</h2>

					</section>

					<section>
						<h2>Middleware introduction</h2>

						<ul>
							<li class="fragment">
								Middleware<small><a href="https://laravel.com/docs/5.3/middleware">&#9873;</a></small> = code executed before or after a request is handled by the application
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Middlewares can be global, or only for a specific route or controller
								<ul>
									<li>Application middleware</li>
									<li>Route/controller specific middleware</li>
								</ul>
							</li>
							<li class="fragment">
								Laravel offers pre-built middlewares located in the <code>app/Http/Middleware</code> directory e.g.
								<ul>
									<li>authentication</li>
									<li>CSRF protection</li>
									<li>&hellip;</li>									
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Defining your own middleware</h2>

						<ul>
							<li class="fragment">
								First step: generate the middelware with Artisan (location: <code>app/Http/Middleware</code>)
								<pre class="bigger"><code class="language-bash dontrun">$ php artisan make:middleware CheckAge</code></pre>
							</li>
							<li class="fragment">
								Example of <em>Before Middleware</em>
								<pre class="bigger"><code class="language-php dontrun">namespace App\Http\Middleware;
use Closure;

class CheckAge
{
    public function handle($request, Closure $next)
    {
        if ($request-&gt;age &lt;= 200) {
            return redirect('home');
        }
        return $next($request);
    }
}</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Before vs. After Middleware</h2>
								<pre class="bigger"><code class="language-php dontrun">class BeforeMiddleware
{
    public function handle($request, Closure $next)
    {
        // Perform action

        return $next($request);
    }
}</code></pre>
<pre class="bigger"><code class="language-php dontrun">class AfterMiddleware
{
    public function handle($request, Closure $next)
    {
        $response = $next($request);

        // Perform action

        return $response;
    }
}</code></pre>
					</section>


					<section>
						<h2>Registering global middleware</h2>

						<ul>
							<li class="fragment">
								Add it to the <code>$middleware</code> property of your <code>app/Http/Kernel.php</code> class
							</li>
							<li class="fragment" style="margin-top: 1em;">
								What's already in there?
								<pre class="bigger"><code class="language-php dontrun">    protected $middleware = [
        \Illuminate\Foundation\Http\Middleware\CheckForMaintenanceMode::class,
    ];</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Registering specific middleware (1)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 1:</strong> assign a short-hand key to the <code>$middleware</code> property of your <code>app/Http/Kernel.php</code> class
							</li>
							<li class="fragment" style="margin-top: 1em;">
								What's already in there?
								<pre class="bigger"><code class="language-php dontrun">    protected $routeMiddleware = [
        'auth' => \App\Http\Middleware\Authenticate::class,
        'auth.basic' => \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'bindings' => \Illuminate\Routing\Middleware\SubstituteBindings::class,
        'can' => \Illuminate\Foundation\Http\Middleware\Authorize::class,
        'guest' => \App\Http\Middleware\RedirectIfAuthenticated::class,
        'throttle' => \Illuminate\Routing\Middleware\ThrottleRequests::class,
    ];</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Registering specific middleware (2)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 2 option 1:</strong> plug the middleware to a specific route
								<pre class="bigger"><code class="language-php dontrun">Route::get('admin/profile', 'UserController@showProfile')-&gt;middleware('auth');</code></pre>
								<pre class="bigger"><code class="language-php dontrun">Route::get('/', function () {
    //
})-&gt;middleware('first', 'second');</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Registering specific middleware (3)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 2 option 2:</strong> plug the middleware to a specific controller
								<ul>
									<li>Call the middleware from the controller's constructor</li>
									<li>It is assigned to all actions in the controller</li>
								</ul>
								<pre class="bigger"><code class="language-php dontrun">class TaskController extends Controller
{
    public function __construct()
    {
        $this-&gt;middleware('auth');

        $this-&gt;middleware('log')-&gt;only('index');

        $this-&gt;middleware('subscribed')-&gt;except('store');
    }
}</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Registering specific middleware (4)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 2 option 3:</strong> plug the middleware to a route group
								<pre class="bigger"><code class="language-php dontrun">Route::group(['middleware' =&gt; 'auth'], function () {
    Route::get('/', function ()    {
        // Uses Auth Middleware
    });

    Route::get('user/profile', function () {
        // Uses Auth Middleware
    });
});</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Middleware Groups</h2>

						<ul>
							<li class="fragment">
								Build groups of middleware in the <code>$middlewareGroups</code> property of your <code>app/Http/Kernel.php</code> class
							</li>
							<li class="fragment" style="margin-top: 1em;">
								What's already in there?
								<pre class="bigger"><code class="language-php dontrun">protected $middlewareGroups = [
    'web' =&gt; [ // can be assigned to a route, a route group or a controller
        \App\Http\Middleware\EncryptCookies::class,
        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \Illuminate\View\Middleware\ShareErrorsFromSession::class,
        \App\Http\Middleware\VerifyCsrfToken::class,
        \Illuminate\Routing\Middleware\SubstituteBindings::class,
    ],</code></pre>
							</li>
							<li>The web middleware group is automatically applied to your <code>routes/web.php</code> file by the <code>RouteServiceProvider</code> !</li>
						</ul>
					</section>					


				</section>


				<!-- Authentication -->
				<section>
					<section>
						<h2>Authentication</h2>

					</section>
					
					
					<section>
						<h2>Authentication introduction</h2>

						<ul>
							<li class="fragment">
								<a href="https://laravel.com/docs/5.3/authentication">Authentication</a> is configured 100% out of the box
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Facilities
								<ul>
									<li><strong>Guards:</strong> how are users authenticated technically? e.g. session, token
									</li>
									<li><strong>Providers:</strong> where is the user information stored and how can it be retrieved? e.g. in the <code>users</code> table with Eloquent</li>
									<li>Resetting passwords</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								These components can be configured in <code>config/auth.php</code>
							</li>
						</ul>
					</section>
					
					
					<section>
						<h2>A default scenario (1)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 1:</strong> make sure you have the <code>users</code> table in your database
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Use the preconfigured migration (or extend it)
								<pre class="bigger"><code class="language-php dontrun">        Schema::create('users', function (Blueprint $table) {
            $table-&gt;increments('id');
            $table-&gt;string('name');
            $table-&gt;string('email')->unique();
            $table-&gt;string('password');
            $table-&gt;rememberToken(); // can store the hash of a login cookie
            $table-&gt;timestamps();
        });</code></pre>
							</li>
							<li class="fragment">
								Use this table in your DB design (foreign keys)
							</li>
							<li class="fragment">
								There is a migration for the table <code>password_resets</code> too
							</li>
						</ul>
						<footer class="fragment"><em>Want to change the table names? Start with <code>config/auth.php</code></em></footer>
					</section>
					
					<section>
						<h2>A default scenario (2)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 2:</strong> you will use Eloquent's preconfigured <code>User</code> model (<code>app/User.php</code>)
								<pre class="bigger"><code class="language-php dontrun">class User extends Authenticatable
{
    // The attributes that are mass assignable.
    protected $fillable = [
        'name', 'email', 'password',
    ];

    // The attributes that should be hidden for arrays. (think of JSON serialization)
    protected $hidden = [
        'password', 'remember_token',
    ];
}</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Extend this class if necessary (for example: Eloquent relationships)
							</li>
						</ul>
					</section>
					
					<section>
						<h2>A default scenario (3)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 3:</strong> make Artisan set up a complete configuration for you (a.k.a. the <em>auth scaffold</em>)
								<pre class="bigger"><code class="language-bash dontrun">$ php artisan make:auth
Authentication scaffolding generated successfully.
								</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								What happened exactly? We'll cover this after the last step &hellip;
							</li>
						</ul>
					</section>
					
					<section>
						<h2>A default scenario (4)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 4:</strong> set your redirect path (= destination after successful authentication)
								<ul>
									<li class="fragment" style="margin-top: 1em;">
										In <code>app/Http/Controllers/Auth/LoginController.php</code>, <code>RegisterController.php</code> and <code>ResetPasswordController.php</code>
										<pre class="bigger"><code class="language-php dontrun">protected $redirectTo = '/tasks'; // '/home' by default

// alternatively, if you need to generate the path from code, define:
// protected function redirectTo()	</code></pre>
									</li>
									<li class="fragment"  style="margin-top: 1em;">
										and in <code>app/Http/Middleware/RedirectIfAuthenticated.php</code> if you use the <code>guest</code> middleware
										<pre class="bigger"><code class="language-php dontrun">return redirect('/tasks');</code></pre>
									</li>									
								</ul>
							</li>
							
						</ul>
					</section>
					
					<section>
						<h2>A default scenario (5)</h2>

						<ul>
							<li class="fragment">
								<strong>Step 5:</strong> plug the <code>auth</code> middleware to each action requiring authentication
								<ul>
									<li class="fragment">
										How? See the slides about middleware
									</li>
									<li class="fragment">
										Preferred way: in the controller(s) or in a route group
									</li>									
								</ul>
							</li>
							<li class="fragment" style="margin-top: 0.3em;">
								Use the <code>Auth</code> facade in your code 
								<pre class="bigger"><code class="language-php dontrun">use Illuminate\Support\Facades\Auth;

$user = Auth::user(); // retrieves the authenticated user
$tasks = Auth::user()->tasks; // oh yes! it's an Eloquent object!
$id = Auth::id(); // retrieves the currently authenticated user's ID

if (Auth::check()) {
    // the user is logged in...
	// you don't need to check this when the route is behind the auth middleware
}

Auth::logout();</code></pre>
							</li>
							
						</ul>
					</section>
					
					<section>
						<h2>What the hell happened? (1)</h2>

						<ul>
							<li class="fragment">
								The auth scaffold generated a core layout (<code>resources/views/layouts/app.blade.php</code>) extended by:
								<ul>
									<li><strong>welcome.blade.php</strong> - the public welcome page</li>
									<li><strong>home.blade.php</strong> - the dashboard for logged-in users</li>
									<li><strong>auth/login.blade.php</strong> - the login page</li>
									<li><strong>auth/register.blade.php</strong> - the register/signup page</li>
									<li><strong>auth/passwords/email.blade.php</strong> - the password reset confirmation page</li>
									<li><strong>auth/passwords/reset.blade.php</strong> - the password reset prompt page</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>Change these templates in order to integrate them in your site layout</em></footer>
					</section>
					
					<section>
						<h2>What the hell happened? (2)</h2>

						<ul>
							<li class="fragment">
								In <code>routes/web.php</code> the line <code>Auth::routes();</code> was added. In fact it is a shorthand for:
								<pre class="bigger"><code class="language-php dontrun">// Authentication Routes...
$this-&gt;get('login', 'Auth\LoginController@showLoginForm')-&gt;name('login');
$this-&gt;post('login', 'Auth\LoginController@login');
$this-&gt;post('logout', 'Auth\LoginController@logout')-&gt;name('logout');

// Registration Routes...
$this-&gt;get('register', 'Auth\RegisterController@showRegistrationForm')-&gt;name('register');
$this-&gt;post('register', 'Auth\RegisterController@register');

// Password Reset Routes...
$this-&gt;get('password/reset', 'Auth\ForgotPasswordController@showLinkRequestForm');
$this-&gt;post('password/email', 'Auth\ForgotPasswordController@sendResetLinkEmail');
$this-&gt;get('password/reset/{token}', 'Auth\ResetPasswordController@showResetForm');
$this-&gt;post('password/reset', 'Auth\ResetPasswordController@reset');</code></pre>
							</li>
						</ul>
						<footer class="fragment"><em>Replace the shorthand by the full code to change or cut down the routes (e.g. no registration allowed)</em></footer>
					</section>
					
					<section>
						<h2>What the hell happened? (3)</h2>

						<ul>
							<li class="fragment">
								The HomeController
								<ul>
									<li>The generated <code>HomeController</code> illustrates how a homepage is shown after a successful login</li>
									<li>There is even a route generated to the <code>HomeController</code> (behind auth middleware)</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>Remove it! It is just a demo</em></footer>
					</section>

					<section>
						<h2>Further customization (1)</h2>

						<ul>
							<li class="fragment">
								<code>app/Http/Controllers/Auth/LoginController</code>

								<ul>
									<li>Here, you can change the field for authentication
										<pre class="bigger"><code class="language-php dontrun">public function username()
{
    return 'username'; // default: 'email'
}</code></pre>
									</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Further customization (2)</h2>

						<ul>
							<li class="fragment">
								<code>app/Http/Controllers/Auth/RegisterController</code>
																

								<pre class="bigger"><code class="language-php dontrun">class RegisterController extends Controller
{   &hellip; 
    protected function validator(array $data)
    {
        return Validator::make($data, [
            'name' =&gt; 'required|max:255',
            'email' =&gt; 'required|email|max:255|unique:users',
            'password' =&gt; 'required|min:6|confirmed']);
    }
	
    protected function create(array $data)
    {
        return User::create([
            'name' =&gt; $data['name'],
            'email' =&gt; $data['email'],
            'password' =&gt; bcrypt($data['password'])]);
    }
}</code></pre>
							</li>
						</ul>
						<footer class="fragment"><em>Change your registration process here (e.g. extra registration fields)</em></footer>
					</section>
					
					<section>
						<h2>Further customization (3)</h2>

						<ul style="font-size: 80%">
							<li class="fragment">
								Digging deeper &hellip;
								<ul>
									<li><code>LoginController</code> uses the trait <code>/vendor/laravel/framework/src/Illuminate/Foundation/Auth/AuthenticatesUsers.php</code></li>
									<li><code>RegisterController</code> uses the trait <code>/vendor/laravel/framework/src/Illuminate/Foundation/Auth/RegistersUsers.php</code></li>
								</ul>
							</li>
							<li>Here you will find many interesting methods such as
								<ul>
									<li>showRegistrationForm() – responsible for showing the registration form,</li>
									<li>register() – responsible for processing the registration request,</li>
									<li>showLoginForm() – responsible for showing the login form,</li>
									<li>login() – responsible forhandling the login request</li>
									<li>validateLogin() – responsible for login form validation</li></ul></li>
							<li class="fragment">
								Override them in <code>app/Http/Controllers/Auth/*</code> (! not in your vendor folder)
							</li>
						</ul>
					</section>					
					
					<section>
						<h2>Further reading</h2>

						<ul>
							<li class="fragment">
								Read the <a href="https://laravel.com/docs/5.3/authentication">Laravel docs on Authentication</a> on
								<ul>
									<li class="fragment">
										Authentication Throttling
									</li>
									<li class="fragment">
										Manually Authenticating Users
									</li>
									<li class="fragment">
										Resetting Passwords
									</li>
									<li class="fragment">
										Customizing guards and providers
									</li>											
								</ul>
							</li>
							
						</ul>
					</section>
					
				</section>
				
				
				
				<!-- Handling forms -->
				<section>
					<section>
						<h2>Handling forms</h2>

					</section>
					
					
					<section>
						<h2>General approach</h2>

						<ul>
							<li class="fragment">
								Blog post routes example
								<pre class="bigger"><code class="language-php dontrun">// Display a form to create a blog post...
Route::get('post/create', 'PostController@create');

// Store a new blog post...
Route::post('post', 'PostController@store');</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								The first route shows a Blade template containing a form	
							</li>
								
									<li class="fragment">
										The second route
										<ul>
											<li class="fragment">
												validates the HTTP request
											</li>
											<li class="fragment">
												stores the blog post
											</li>
											<li class="fragment">
												redirects the user
											</li>
										</ul>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>About the other HTTP Verbs</h2>

						<ul>
							<li class="fragment">
								Blog post routes example
								<pre class="bigger"><code class="language-php dontrun">// Display a form to create a blog post...
Route::get('post/create', 'PostController@create');

// Store a new blog post...
Route::post('post', 'PostController@store');</code></pre>
							</li>

									<li class="fragment">
										Don't use the other HTTP verbs (delete, put, patch)
									<ul>
										<li class="fragment">
											not (enough) compatible with HTML forms
										</li>
										<li class="fragment">
											&hellip; unless you're faking the verbs with <a href="https://laravel.com/docs/master/routing#form-method-spoofing">form method spoofing</a>
										</li>
										<li class="fragment">
											&hellip; unless you're building a RESTful web API
										</li>
									</ul>
							</li>
						</ul>
					</section>					
					
					<section>
						<h2>Cross-Site Request Forgery (CSRF)</h2>
						<ul>
							<li class="fragment">CSRF = A serious type of attack</li>
						</ul>
						<blockquote style="width: 100%; margin-top: 1em;" class="fragment">A CSRF attack forces a logged-on victim’s browser to send a forged HTTP request, including the victim’s session cookie and any other automatically included authentication information, to a vulnerable web application. This allows the attacker to force the victim’s browser to generate requests the vulnerable application thinks are legitimate requests from the victim.</blockquote>
						<ul>
							<li class="fragment" style="margin-top: 1em;">FIX: Generate a CSRF token on each form load <em>(and limit that token to that form only)</em> and validate it too.</li>
						</ul>
					</section>
					
					<section>
						<h2>CSRF Protection</h2>

						<ul>
							<li class="fragment">
								Include the automatically generated CSRF field/token in your (POST) form
								<pre class="bigger"><code class="language-php dontrun">// Vanilla PHP
&lt;?php echo csrf_field(); ?&gt;

// Blade Template Syntax &hellip;
{{ csrf_field() }}

// &hellip; is the equivalent of:
&lt;input type="hidden" name="_token" value="{{ csrf_token() }}"&gt;
</code></pre>
							</li>
							<li class="fragment">
								The <code>VerifyCsrfToken</code> middleware (part of the <code>web</code> group) is already activated and does the checking
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Read the <a href="https://laravel.com/docs/5.3/csrf">Laravel docs on CSRF Protection</a> on excluding CSRF protection and CSRF support for JS frameworks
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Flash data in the session</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								By default the middleware <code>\Illuminate\Session\Middleware\StartSession</code> <br/>backs a permanent PHP session
							</li>
							<li class="fragment">
								Store and retrieve session variables with <em>put</em> and <em>get</em> (<a href="https://laravel.com/docs/5.3/session">docs</a>)
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Flash a variable = store variable in the session only for the next HTTP request
								<pre class="bigger"><code class="language-php dontrun">$request-&gt;session()->flash('status', 'Task was successful!');
								
$request-&gt;session()-&gt;reflash(); // flash all data once again!

$request-&gt;session()-&gt;keep(['username', 'email']); // the same for a selection of vars
</code></pre>
							</li>
						</ul>
					</section>
					
					<section style="font-size: 85%">
						<h2>A simple form v1 (1)</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								The Blade template
							<pre class="bigger"><code class="language-php dontrun">@include('common.errors') {{-- visualizes the $errors array --}}
		
&lt;form method="POST" action="<span style="background-color: #500;">{{ url('post') }}</span>" accept-charset="UTF-8"&gt;
	<span style="background-color: #500;">{!! csrf_field() !!}</span>
	&lt;div class="form-group"&gt;
		&lt;label for="title"&gt;Title:&lt;/label&gt;
		&lt;input class="form-control" name="title" type="text" 
		       value="<span style="background-color: #500;">{{ old('title', '') }}</span>" id="title"&gt;
	&lt;/div&gt;
	
	&lt;div class="form-group"&gt;
		&lt;label for="content"&gt;Content:&lt;/label&gt;
		&lt;textarea class="form-control" rows="10" name="content" cols="50" id="content"&gt;
			<span style="background-color: #500;">{{ old('content', '') }}</span>&lt;/textarea&gt;
	&lt;/div&gt;
	
	&lt;input class="btn btn-primary pull-right" type="submit" value="submit"&gt;

&lt;/form&gt;
</code></pre>
							</li>
							<li class="fragment">
										The helper method <a href="https://laravel.com/docs/5.3/helpers#method-old">old</a> retrieves an old input value flashed into the session
							</li>	
						</ul>
					</section>
					
					<section style="font-size: 85%">
						<h2>A simple form v1 (2)</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								The controller
							<pre class="bigger"><code class="language-php dontrun">public function add()
{
	return view('blogpost.add');
}

public function store(Request $request)
{
	// building oldskool form errors &hellip;
	$errors = array();
	
	if (!(($request-&gt;has('title')) && (strlen($request-&gt;title) &gt; 0))) {
		$errors[] = 'The title field is required.';
	} else if (strlen($request-&gt;title) &gt; 125) {
		$errors[] = 'The title may not be greater than 125 characters.';
	} else if (Blogpost::where('title', $request-&gt;title)-&gt;exists()) {
		$errors[] = 'The title has already been taken.';
	}
	
	if (!(($request-&gt;has('content')) && (strlen($request-&gt;content) &gt; 0))) {
		$errors[] = 'The content field is required.';
	}
	
	&hellip;</code></pre>
							</li>
						</ul>
					</section>

					<section style="font-size: 85%">
						<h2>A simple form v1 (3)</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								The controller
							<pre class="bigger"><code class="language-php dontrun">public function store(Request $request)
{
	// building oldskool form errors &hellip;
	&hellip;

	if (count($errors) &gt; 0) {
		// flash the form errors in the session
		$request-&gt;session()-&gt;flash('errors', $errors);
		
		// flash the request inputs in the session and take previous route
		$request-&gt;flash();
		return back();

		// also possible: return back()-&gt;withInput();
		
	} else {		
		Blogpost::create($request-&gt;all()); // mass assignment
		return redirect('/post/success');
	}
}
</code></pre>
							</li>
						</ul>
					</section>							

					
					<section>
						<h2>Validation (1)</h2>

						<ul>
							<li class="fragment">
								In our controller, the <code>validate</code> method
								<ul>
									<li class="fragment">
										takes the HTTP request and desired validation rules
									</li>
									<li class="fragment">
										redirects the user back to his previous location upon failure (+ auto-flash of errors and input values)
									</li>									
								</ul>
								<pre class="bigger"><code class="language-php dontrun">public function store(Request $request)
{
    $this-&gt;validate($request, [
        'title' =&gt; 'required|unique:blogposts|max:125',
        'content' =&gt; 'required',
    ]);

    // The blog post is valid, store in database...
}</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Validation (2)</h2>

						<ul>
							<li class="fragment">
								Anticipating validation in your Blade templates
								<ul>
									<li class="fragment">
										The <code>ShareErrorsFromSession</code> middleware (part of the <code>web</code> group) assures an <code>$errors</code> variable is available in your views
									</li>
									<li class="fragment">
										Enjoy the richness of <a href="https://laravel.com/docs/5.3/validation#available-validation-rules">the rules available</a>
									</li>									
								</ul>
								<pre class="bigger"><code class="language-php dontrun">'start_date' =&gt; 'required|date|after:tomorrow',
'finish_date' =&gt; 'required|date|after:start_date',

'photo' =&gt; 'image', // is an image of any type
'avatar' =&gt; 'dimensions:min_width=100,min_height=200', // image with specified dimensions
						
'state' =&gt; 'exists:states,abbreviation', // exists in column abbreviation of table states
'email' =&gt; 'exists:staff,email,user_id,23' // exists in column email where user_id=23
// actually we have Authorization for the last rule example</code></pre>
							</li>
						</ul>
					</section>

					<section>
						<h2>Validation (3)</h2>

						<ul>
							<li class="fragment">
								Read the <a href="https://laravel.com/docs/5.3/validation">Laravel docs on Validation</a> on
								<ul>
									<li class="fragment">
										Stopping On First Validation Failure (bail)
									</li>
									<li class="fragment">
										Validating arrays
									</li>
									<li class="fragment">
										Form Request = classes containing the validation logic
									</li>
									<li class="fragment">
										Working With (field related) Error Messages
									</li>
									<li class="fragment">
										Customizing Error Messages
									</li>									
									<li class="fragment">
										Available Validation Rules		
									</li>	
								</ul>
							</li>
							
						</ul>
					</section>

					<section style="font-size: 85%">
						<h2>A simple form v2 (1)</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								The new version of the controller
							<pre class="bigger"><code class="language-php dontrun">public function add()
{
	return view('blogpost.add');
}

public function store(Request $request)
{
	$this-&gt;validate($request, [
		'title' =&gt; 'required|unique:blogposts|max:125',
		'content' =&gt; 'required'
	]);

	Blogpost::create($request-&gt;all());

	return redirect('/post/success');
}</code></pre>
							</li>
						</ul>
					</section>

					<section style="font-size: 85%">
						<h2>A simple form v2 (2)</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								Change <code>common/errors.blade.php</code> such that it visualizes an <em>$errors</em> <strong>collection</strong>
								<pre class="bigger"><code class="language-php dontrun">@if (count($errors) &gt; 0)
    &lt;!-- Form Error List --&gt;
    &lt;div class="alert alert-danger"&gt;
        &lt;strong&gt;Whoops! Something went wrong!&lt;/strong&gt;

        &lt;br&gt;&lt;br&gt;

        &lt;ul&gt;
            @foreach ($errors-&gt;all() as $error)
                &lt;li&gt;{{ $error }}&lt;/li&gt;
            @endforeach
        &lt;/ul&gt;
    &lt;/div&gt;
@endif</code></pre>
							</li>
						</ul>
					</section>
					
					<section>
						<h2>Collective's Forms &amp HTML</h2>

						<ul>
							<li class="fragment">
								In Laravel 4, it was possible to generate HTML form code using Laravel shorthands
								<ul>
									<li class="fragment">
										<a href="https://laravelcollective.com/docs/5.3/html">Forms &amp HTML</a> has been removed from the core framework and is currently maintained by <a href="https://laravelcollective.com/">Laravel Collective</a>
									</li>
									<li class="fragment">
										You need to install it through Composer
									</li>									
								</ul>
							</li>
						</ul>
						<footer class="fragment"><em>This is not a mandatory library!</em></footer>
					</section>

					<section style="font-size: 85%">
						<h2>A simple form v3</h2>

						<ul style="font-size: 85%">
							<li class="fragment">
								The new version of the Blade template
							<pre class="bigger"><code class="language-php dontrun">@include('common.errors') {{-- visualizes the $errors object --}}

{!! Form::open(['url' =&gt; 'post', 'method' =&gt; 'POST']) !!}

&lt;div class="form-group"&gt;
	{!! Form::label('title', 'Title:') !!}
	{!! Form::text('title', '', ['class' =&gt; 'form-control']) !!}
&lt;/div&gt;

&lt;div class="form-group"&gt;
	{!! Form::label('content', 'Content:') !!}
	{!! Form::textarea('content', '', ['class' =&gt; 'form-control', 'rows' =&gt; '10']) !!}
&lt;/div&gt;
	
{!! Form::submit('submit', ['class' =&gt; 'btn btn-primary pull-right']) !!}
{!! Form::close() !!}
</code></pre>
							</li>
							<li class="fragment">
								Advantage: csrf_field() and old() are generated for you !!!
							</li>	
						</ul>
					</section>					
				
				</section>
				
				<!-- Working with files -->
				<section>
					<section>
						<h2>Working with files</h2>

					</section>
					
					
					<section style="font-size: 85%">
						<h2>Filesystem &ne; public folder</h2>

						<ul>
							<li class="fragment">
								The <a href="https://laravel.com/docs/5.3/structure#the-public-directory">public folder</a> contains the assets (img, css, js, &hellip;)
								<ul>
									<li class="fragment">Assets directly accessible from the web server (link it with <code>asset()</code>)</li>
									<li class="fragment"><em>By default,</em> you cannot handle (= store, edit, list, &hellip;) files there</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 0.5em;">
								<a href="https://laravel.com/docs/5.3/filesystem">Filesystem</a> is an abstraction layer which allows you to handle files on local and remote (cloud) systems in a uniform way
								<ul>
									<li class="fragment">
										To be configured in <code>config/filesystems.php</code>
									</li>
									<li class="fragment"><em>By default,</em> <code>public</code> disk is selected, using the <code>local</code> driver and stores these files in <code>storage/app/public</code> (not publicly accessible)</li>
									<li class="fragment">
										Luckily, you can create a symbolic link from <code>public/storage</code> to <code>storage/app/public</code>  &#9786;
										<pre class="bigger"><code class="language-bash dontrun">$ php artisan storage:link
The [public/storage] directory has been linked.</code></pre>
									</li>
									<li class="fragment">
										Keep on using the <code>asset()</code> helper:
										<code class="language-php dontrun">{{ asset('storage/file.txt') }}</code>
									</li>
								</ul>
							</li>
						</ul>
					</section>
					
					<section style="font-size: 90%">
						<h2>File uploads</h2>
						<ul>
							<li class="fragment">
								Checklist
								<ol>
									<li class="fragment" style="margin-top: 0.3em;">Create a symbolic link to <code>storage/app/public</code> or configure Filesystem</li>
									<li class="fragment" style="margin-top: 0.3em;">In your form (Views): check your <code>enctype</code> attribute (see
										<a href="https://ikdoeict.be/apps/leercentrum/courses/ws-bs-course-materials/03.forms.html#/">this course</a>)  </li>
									<li class="fragment" style="margin-top: 0.3em;">Access the uploaded file through the HTTP request object (<a href="04.laravel.basics.html#/3/7">code example</a>)</li>
									<li class="fragment" style="margin-top: 0.3em;">Validation: check on file (MIME) type and eventually file size, dimension, &hellip;
										<ul>
											<li class="fragment">
												Use a <code>*</code> with multiple file uploads e.g. <code>documents.*</code>
											</li>
											<li class="fragment">
												Hint: <code>image</code> is a rule too
											</li>
											<li class="fragment">
												<strong>Check the type. Don't let *.php (and many others) pass!</strong>
											</li>
										</ul>
									</li>
									<li class="fragment" style="margin-top: 0.3em;">Of course you need to <a href="https://laravel.com/docs/5.3/filesystem#file-uploads">store the file upload</a>
										<ul>
											<li class="fragment">
												Most of the time, it's a good practice to rename the original file (think of duplicates and of a clean directory structure)
											</li>
											<li class="fragment">
												If the path (relative to Filesystem root) does not exist, the folders are created
											</li>
										</ul>
									</li>
								</ol>
							</li>
						</ul>
					</section>					
				</section>

			

				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							<li><a href="https://laravel.com/docs/5.3/middleware">Laravel docs: Middleware</a></li>
							<li><a href="https://laravel.com/docs/5.3/authentication">Laravel docs: Authentication</a></li>
							<li><a href="https://mattstauffer.co/blog/the-auth-scaffold-in-laravel-5-2">Matt Stauffer: The auth scaffold in Laravel 5.2</a></li>
							<li><a href="https://laravel.com/docs/5.3/routing#route-groups">Laravel docs: Route Groups</a></li>
							<li><a href="https://laravelcollective.com/docs/5.3/html">Laravel Collective docs: Forms &amp; HTML</a></li>
							<li><a href="https://laravel.com/docs/5.2/quickstart-intermediate">Laravel tutorial on a task list project - intermediate</a> (version 5.2)</li>
							<li><a href="https://laravel.com/docs/5.3/filesystem">Laravel docs: Filesystem</a> </li>
						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>
