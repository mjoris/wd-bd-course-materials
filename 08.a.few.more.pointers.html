<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Web Development &mdash; Serverside Development</title>

		<link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/main.css" media="screen">
		<link rel="stylesheet" href="css/print.css" media="print">

		<link rel="stylesheet" href="lib/zenburn.css">
		<style>
			html, body {
				background: #34afbd;
				background: -moz-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -webkit-gradient(radial, center center, 0px, center center, 100%, color-stop(0%,#34afbd), color-stop(100%,#1c1e20));
				background: -webkit-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -o-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: -ms-radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				background: radial-gradient(center, ellipse cover, #34afbd 0%,#1c1e20 100%);
				letter-spacing: 0em;
			}

			#reveal nav {
				opacity: 0.3;
				letter-spacing: -0.02em;
			}
		</style>
	</head>

	<body>

		<div id="reveal">

			<div class="slides">

				<!-- Title -->
				<section>
					<section>
						<h3 class="inverted">Serverside Development <small>[JLW506]</small></h3>
						<h1>08.a few more pointers</h1>
						<h3>on pagination and filtering</h3>

						<footer>
							<em>Course materials: <a href="http://www.bram.us/">Bram(us) Van Damme</a> &amp; <a href="mailto:joris.maervoet@odisee.be">Joris Maervoet</a></em>
						</footer>
						<script>
							// Delicously hacky. Look away.
							if( navigator.userAgent.match( /(iPhone|iPad|iPod|Android)/i ) )
							document.write( '<p style="color: rgba(0,0,0,0.3); text-shadow: none;">('+'Tap to navigate'+')</p>' );
						</script>
					</section>
				</section>
				

				<!-- Pagination -->
				<section>
					<section>
						<h2>Pagination</h2>
						<p style="margin-top: 2.5em;"><img src="assets/08/pagination.jpg" alt="" title="" width="600" /></p>
					</section>

					<section>
						<h2>Pagination?</h2>
						<ul>
							<li class="fragment">
								When having too many items to show, split them into several pages
								<ul>
									<li class="fragment">e.g. search results, filter results</li>
									<li class="fragment">Paginator typically placed beneath the results</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Examples</h2>
						<ul>
							<li class="fragment" style="margin-top: 1em">
								Bad examples:
								<p style="text-align: center"><img src="assets/08/pagination-bad-2.jpg" alt="" title="" width="447" /><br /><img src="assets/08/pagination-bad-1.png" alt="" title="" width="447" /></p>
							</li>
							<li class="fragment">
								Good example:
								<div class="hastooltip" style="width: 550px; margin: 0 auto;">
									<p style="text-align: center"><img src="assets/08/pagination-good-flickr.png" alt="" title="" width="447" /></p>
									<div class="tooltip">
										<div>
											<ul>
												<li>Always indicate how many results there are</li>
												<li>Always indicate how many pages there are</li>
												<li>
													Show a reasonable number of pages
													<ul>
														<li>The number row automgically adjusts itself based on the current page</li>
														<li>First two and last two pages always shown</li>
														<li>All, except the current page, clickable</li>
													</ul>
												</li>
												<li>
													Always indicate current active page
													<ul>
														<li>Don't link it though!</li>
													</ul>
												</li>
												<li>
													Always show next/previous buttons
													<ul>
														<li>Only clickable when necessary</li>
													</ul>
												</li>
												<li>Don't show First/Last links (no direct value)</li>
											</ul>
										</div>
									</div>
								</div>
							</li>
						</ul>
					</section>

					<section>
						<h2>Manual approach: what we would need</h2>
						<ul>
							<li class="fragment">
								From <u>database</u>: Total number of items
							</li>
							<li class="fragment">
								Number of items to show per page
							</li>
							<li class="fragment">
								Parameter in <u>url</u>: current page <em>(default = 1)</em>
							</li>
							<li class="fragment">
								To <u>calculate</u>: number of pages
								<pre class="bigger"><code class="language-php">$numPages = ceil($numItems / $numItemsPerPage);</code></pre>
							</li>
							<li class="fragment">
								From <u>database</u>: a subset of items (ORDER BY, LIMIT)
							</li>
							<li class="fragment">
								A pagination rendering strategy
							</li>
						</ul>
					</section>

					<section>
						<h2>Pagination in Laravel (1)</h2>
						<ul>
							<li class="fragment">
								Use the <code>paginate</code> method with Query Builder or Eloquent
								<ul>
									<li class="fragment">
										detects <code>?page</code> query string argument on the HTTP request
									</li>
									<li class="fragment">
										gets the items from the DB through proper limit and offset
									</li>
									<li class="fragment">
										returns a paginator object which is loopable like a result set
									</li>
								</ul>
								<pre class="bigger"><code class="language-php">    public function index() // controller method
    {
        $users = User::where('votes', '&gt;', 100)-&gt;paginate(15);
		// uncomment next line to change the paginator's target URL
		// $users-&gt;setPath('custom/url');
        return view('user.index', ['users' =&gt; $users]);
    }</code></pre>
							</li>
							<li class="fragment" style="margin-top: 1em">Don't use <code>simplePaginate</code>: it will only generate prev/next buttons</li>
						</ul>
					</section>
					
					<section>
						<h2>Pagination in Laravel (2)</h2>
						<ul>
							<li class="fragment">
								Simple (bootstrap compatible) display in Blade
								<pre class="bigger"><code class="language-php">&lt;div class="container"&gt;
    @foreach ($users as $user)
        {{ $user->name }}
    @endforeach
&lt;/div&gt;

{{ $users->links() }}
Or with appended GET parameters: {{ $users->appends(['sort' => 'votes'])->links() }}</code></pre>
							</li>
							<li class="fragment">
								It's up to you to find a better strategy than rendering all the page links
								<ul>
									<li class="fragment">
										Use the pagination methods in separate pagination templates: <a href="https://laravel.com/docs/5.3/pagination#customizing-the-pagination-view">howto</a>
									</li>
									<li class="fragment">
										Watch this <a href="https://gist.github.com/bramus/5d8f2e0269e57dff5136">clever algorithm</a>
									</li>
								</ul>
							</li>
							
						</ul>
					</section>



				</section>


				<!-- Filtering -->
				<section>
					<section>
						<h2>Filtering</h2>
						<p><img src="assets/08/filter.png" alt="" title="" width="600" class="noborder" /></p>
					</section>

					<section>
						<h2>Filtering?</h2>
						<ul>
							<li class="fragment">
								Allow a visitor to refine a set of results
								<ul>
									<li class="fragment">A form with checkboxes, dropdowns, etc. per defining property of the result set</li>
									<li class="fragment">Typically placed on the left hand side, next to the results</li>
									<li class="fragment">It is necessary to persist the form values (!)</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 0.5em;">
								Typically in combination with
								<ul>
									<li class="fragment">Pagination</li>
									<li class="fragment">Sorting on specific properties of the result set (asc/desc)</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Filtering scenarios</h2>
						<ul>
							<li class="fragment">
								Filter via <code>GET</code> params
								<ul>
									<li class="fragment">Pro: links can be shared/bookmarked</li>
									<li class="fragment">Con: links become cluttered</li>
									<li class="fragment">Con: filter not preserved after having navigated away</li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 1em;">
								Filter via <code>Session</code> params
								<ul>
									<li class="fragment">Pro: links don't become cluttered</li>
									<li class="fragment">Pro: filter preserved after having navigated away</li>
									<li class="fragment">Con: links can't be shared/bookmarked</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Some Laravel filtering hints</h2>
						<ul style="font-size: 75%">

							<li class="fragment">
								In the controller
								<ul>
									<li class="fragment">Validate your input data e.g. <code>'brand_id' =&gt; 'exists:brands'</code></li>
									<li class="fragment"><code>Session</code> scenario: add your inputs to the session</li>
									<li class="fragment">For each activated filter field, apply a <em>chainable</em> method e.g. <br/><code>if (&hellip;) $products-&gt;where('brand_id', $request-&gt;brand_id);</code> (or use
										<a href="https://laravel.com/docs/5.3/queries#conditional-clauses">when</a>)
										<ul>
											<li class="fragment"><strong>Pitfall: in SQL, AND has precedence over OR.</strong> This happens when you chain <code>where()</code> and <code>orWhere()</code> serially. Use
											<a href="https://laravel.com/docs/5.3/queries#parameter-grouping">(or)where grouping</a> instead.</li>
										</ul>
									</li>
									<li class="fragment">Pass your search results, existing categories and persisted values to the View e.g. <code>return view('webshop.search', ['products' =&gt; $products, 'brands' =&gt; $brands, 'brand_id' =&gt; $brand_id]);</code></li>
								</ul>
							</li>
							<li class="fragment" style="margin-top: 0.3em;">
								In the Views
								<ul>
									<li class="fragment">Collective's <a href="https://laravelcollective.com/docs/5.3/html">Forms &amp HTML</a> supports persistence for many types of form elements. Set the persisted value as the element's default:
										<code>Form::select('brand_id', $brands, $brand_id)</code></li>
									<li class="fragment"><code>GET</code> scenario: append your params to your pagination URLs e.g. <br/><code>$products->appends(['brand_id' => $brand_id ])->links()</code>
									</li>
								</ul>
							</li>
						</ul>
						<footer class="fragment" style="font-size: 50%"><em>When the validation fails, old input is flashed into the session and has priority over the element's default</em></footer>
					</section>

				</section>

				<!-- Advanced code generation hints -->
				<section>
					<section>
						<h2>Advanced code generation hints</h2>
					</section>

					<section>
						<h2>Resource controllers</h2>
						<ul style="font-size: 90%">
							<li class="fragment">
								Assign all your <em>CRUD</em> routes to a controller in a single line of code
								<ul>
									<li class="fragment">Generate the controller:
										<pre class="bigger"><code class="language-bash dontrun">$ php artisan make:controller PhotoController --resource</code></pre>
									</li>
									<li class="fragment">Register the routes:
										<pre class="bigger"><code class="language-php dontrun">Route::resource('photos', 'PhotoController'); // available options: 'only', 'except'</code></pre>
									</li>
									<li>Result:
										<table style="font-size: 50%; line-height: 1; margin-left: 4.3em; background-color: #2aabd2;">
											<thead>
											<tr style="font-weight: bold;background-color: #1b6d85;">
												<th style="padding: 1px;">Verb</th>
												<th style="padding: 1px;">URI</th>
												<th style="padding: 1px;">Action</th>
												<th style="padding: 1px;">Route Name</th>
											</tr>
											</thead>
											<tbody>
											<tr>
												<td>GET</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos</code></td>
												<td>index</td>
												<td>photos.index</td>
											</tr>
											<tr>
												<td>GET</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos<span class="token operator">/</span>create</code></td>
												<td>create</td>
												<td>photos.create</td>
											</tr>
											<tr>
												<td>POST</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos</code></td>
												<td>store</td>
												<td>photos.store</td>
											</tr>
											<tr>
												<td>GET</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos<span class="token operator">/</span><span class="token punctuation">{</span>photo<span class="token punctuation">}</span></code></td>
												<td>show</td>
												<td>photos.show</td>
											</tr>
											<tr>
												<td>GET</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos<span class="token operator">/</span><span class="token punctuation">{</span>photo<span class="token punctuation">}</span><span class="token operator">/</span>edit</code></td>
												<td>edit</td>
												<td>photos.edit</td>
											</tr>
											<tr>
												<td>PUT/PATCH</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos<span class="token operator">/</span><span class="token punctuation">{</span>photo<span class="token punctuation">}</span></code></td>
												<td>update</td>
												<td>photos.update</td>
											</tr>
											<tr>
												<td>DELETE</td>
												<td><code class=" language-php"><span class="token operator">/</span>photos<span class="token operator">/</span><span class="token punctuation">{</span>photo<span class="token punctuation">}</span></code></td>
												<td>destroy</td>
												<td>photos.destroy</td>
											</tr>
											</tbody>
										</table>
									</li>
									<li class="fragment">In a web app, you will need to spoof the methods DELETE, PUT and PATCH</li>
								</ul>
							</li>
						</ul>
					</section>

					<section>
						<h2>Collective's Form Model Binding</h2>
						<ul style="font-size: 90%">
							<li class="fragment">
								Populate an HTML form based on the contents of a model
								<ul>
									<li class="fragment">Start the form by
										<pre class="bigger"><code class="language-php dontrun">{!! Form::model($user, ['route' => ['user.update', $user->id]]) !!}</code></pre>
									</li>
									<li>Flash data has precedence over the contents !

									</li>
									<li class="fragment">Don't forget to <code>Form::close</code></li>
								</ul>
							</li>
						</ul>
					</section>
				</section>

				<!-- The END -->
				<section>
					<section>
						<h2>Questions?</h2>
						<footer>
							<em><a href="http://www.ikdoeict.be/">ikdoeict.be</a> &mdash; <a href="mailto:joris.maervoet@odisee.be">joris.maervoet@odisee.be</a></em>
						</footer>
					</section>
				</section>



				<!-- Sources -->
				<section id="sources">
					<section>
						<h2>Sources</h2>
						<ul>
							<li><a href="https://laravel.com/docs/5.3/pagination">Laravel docs: Pagination</a></li>
							<li><a href="https://laravel.com/docs/5.3/session">Laravel docs: Session</a></li>
						</ul>
					</section>
				</section>

			</div>

			<!-- The navigational controls UI -->
			<aside class="controls">
				<a class="left" href="#">&#x25C4;</a>
				<a class="right" href="#">&#x25BA;</a>
				<a class="up" href="#">&#x25B2;</a>
				<a class="down" href="#">&#x25BC;</a>
				<span id="revealIndex">/</span>
			</aside>

			<!-- Index Link -->
			<aside class="back">
				<a href="index.html">&larr; Back to index</a>
			</aside>

			<!-- ikdoeict.be Link -->
			<a href="http://www.ikdoeict.be/" title="ikdoeict.be" id="ikdoeict">ikdoeict.be</a>

			<!-- Displays presentation progress, max value changes via JS to reflect # of slides -->
			<div class="progress"><span></span></div>

		</div>

		<script src="js/reveal.js"></script>
		<script src="lib/highlight.js"></script>
		<script src="lib/prefixfree.js"></script>
		<script src="lib/css-snippets.js"></script>
		<script src="lib/css-edit.js"></script>
		<script src="lib/incrementable.js"></script>
		<script src="js/main.js"></script>

	</body>
</html>
